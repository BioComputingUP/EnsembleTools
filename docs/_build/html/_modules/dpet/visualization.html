<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dpet.visualization &mdash; Disordered Protein Ensemble Tools 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=8d563738"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Disordered Protein Ensemble Tools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">EnsembleTools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction to Disordered Protein Ensemble Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Disordered Protein Ensemble Tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">dpet.visualization</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for dpet.visualization</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.backends.backend_pdf</span> <span class="kn">import</span> <span class="n">PdfPages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">import</span> <span class="nn">mdtraj</span>
<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>

<span class="kn">from</span> <span class="nn">dpet.ensemble_analysis</span> <span class="kn">import</span> <span class="n">EnsembleAnalysis</span>
<span class="kn">from</span> <span class="nn">dpet.featurization.angles</span> <span class="kn">import</span> <span class="n">featurize_a_angle</span>
<span class="kn">from</span> <span class="nn">dpet.data.coord</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>

<span class="n">PLOT_DIR</span> <span class="o">=</span> <span class="s2">&quot;plots&quot;</span>

<div class="viewcode-block" id="Visualization">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization">[docs]</a>
<span class="k">class</span> <span class="nc">Visualization</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="n">EnsembleAnalysis</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span> <span class="o">=</span> <span class="n">analysis</span>
        <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figures</span> <span class="o">=</span> <span class="p">{}</span>

<div class="viewcode-block" id="Visualization.tsne_ramachandran_plot_density">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.tsne_ramachandran_plot_density">[docs]</a>
    <span class="k">def</span> <span class="nf">tsne_ramachandran_plot_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the 2-D histogram ramachandran plots of the</span>
<span class="sd">        clusters from t-SNE analysis. \n</span>
<span class="sd">        The results is only meaningful when the extracted feature is &quot;phi_psi&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">!=</span> <span class="s2">&quot;tsne&quot;</span> <span class="ow">or</span> <span class="n">analysis</span><span class="o">.</span><span class="n">featurization</span> <span class="o">!=</span> <span class="s2">&quot;phi_psi&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This analysis is only valid for t-SNE reduction with phi_psi feature extraction.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        
        <span class="n">rama_bins</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">rama_linspace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">rama_bins</span><span class="p">)</span>
        
        <span class="c1"># Calculate the number of rows and columns for subplots</span>
        <span class="n">num_rows</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">num_cols</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">bestK</span> <span class="o">//</span> <span class="n">num_rows</span> <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">bestK</span> <span class="o">%</span> <span class="n">num_rows</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">bestK</span> <span class="o">//</span> <span class="n">num_rows</span> <span class="o">+</span> <span class="mi">1</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">num_cols</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="n">num_rows</span> <span class="o">*</span> <span class="mi">5</span><span class="p">))</span>

        <span class="c1"># Flatten axes if necessary</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">cluster_id</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">bestK</span><span class="p">)),</span> <span class="n">axes</span><span class="p">):</span>
            <span class="n">cluster_frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_kmeans</span><span class="o">.</span><span class="n">labels_</span> <span class="o">==</span> <span class="n">cluster_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">phi</span><span class="p">,</span> <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">concat_features</span><span class="p">[</span><span class="n">cluster_frames</span><span class="p">])</span> <span class="p">,</span> <span class="mi">2</span> <span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">phi_flat</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">psi_flat</span> <span class="o">=</span> <span class="n">psi</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="n">hist</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span>
            <span class="n">phi_flat</span><span class="p">,</span>
            <span class="n">psi_flat</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">rama_linspace</span><span class="p">,</span> <span class="n">rama_linspace</span><span class="p">),</span> 
            <span class="n">norm</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span>
            <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ramachandran Plot for cluster </span><span class="si">{</span><span class="n">cluster_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Phi (ϕ) Angle (degrees)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Psi (ψ) Angle (degrees)&#39;</span><span class="p">)</span>
        
        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;tsne_ramachandran_plot_density&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figures</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">figures</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_dir</span>  <span class="o">+</span><span class="s1">&#39;/tsnep&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">bestP</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_kmeans&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">bestK</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_ramachandran.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span></div>

        <span class="c1">#return fig</span>


<div class="viewcode-block" id="Visualization.tsne_scatter_plot">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.tsne_scatter_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">tsne_scatter_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the results of t-SNE analysis. </span>
<span class="sd">        Three scatter plot will be generated based on original, clustering and Rg labels. </span>
<span class="sd">        One KDE density plot will also be generated to shod the most populated areas in </span>
<span class="sd">        the reduced dimension.   </span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">!=</span> <span class="s2">&quot;tsne&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for t-SNE dimensionality reduction.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        
        <span class="n">bestclust</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_kmeans</span><span class="o">.</span><span class="n">labels_</span>
        <span class="n">fig</span> <span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span> <span class="p">,</span><span class="mi">4</span><span class="p">))</span> 

        <span class="c1"># scatter original  labels</span>
        <span class="n">label_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="s2">&quot;#</span><span class="si">{:06x}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0xFFFFFF</span><span class="p">))</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">}</span>
        <span class="n">point_colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">label</span><span class="p">:</span> <span class="n">label_colors</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">all_labels</span><span class="p">))</span>
        <span class="n">scatter_labeled</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">point_colors</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
        
        <span class="c1"># scatter Rg labels </span>
        <span class="c1"># Rg in Angstrom</span>
        <span class="n">rg_labeled</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span> <span class="p">[</span><span class="n">rg</span> <span class="k">for</span> <span class="n">rg</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">rg</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> 
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">rg_labeled</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>
        
        <span class="c1"># scatter cluster labels</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">bestK</span><span class="p">)</span>
        <span class="n">scatter_cluster</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span> <span class="n">bestclust</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span> <span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        
        <span class="c1"># manage legend</span>
        <span class="n">legend_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">label_colors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">legend_handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">label_colors</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">legend_labels</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_handles</span><span class="p">,</span> <span class="n">legend_labels</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Origanl Labels&#39;</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower left&#39;</span><span class="p">)</span>

        <span class="c1"># KDE plot</span>
        <span class="c1">#sns.kdeplot(x=analysis.reducer.best_tsne[:, 0], y=analysis.reducer.best_tsne[:, 1], ax=ax4, fill=True, cmap=&#39;Blues&#39;, levels=5)</span>
        <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">([</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]])</span>
        <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span><span class="nb">max</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span>
                        <span class="nb">min</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]):</span><span class="nb">max</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]):</span><span class="mi">100</span><span class="n">j</span><span class="p">]</span>
        <span class="n">zi</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">xi</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">yi</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]))</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
        
        <span class="c1"># ax1.scatter(grid_positions[0, densest_indices], grid_positions[1, densest_indices], c=&#39;red&#39;, marker=&#39;x&#39;, s=50, label=&#39;Densest Points&#39;)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Scatter plot (original labels)&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Scatter plot (clustering labels)&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Scatter plot (Rg labels)&#39;</span><span class="p">)</span>
        <span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Density Plot &#39;</span><span class="p">)</span>

        <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;tsne_scatter_plot&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figures</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">figures</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
        
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_dir</span>  <span class="o">+</span><span class="s1">&#39;/tsnep&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">bestP</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_kmeans&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">bestK</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;_scatter.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span></div>

        <span class="c1">#return fig</span>

<div class="viewcode-block" id="Visualization.dimenfix_scatter">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.dimenfix_scatter">[docs]</a>
    <span class="k">def</span> <span class="nf">dimenfix_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the the complete results for dimenfix method. </span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">!=</span> <span class="s2">&quot;dimenfix&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for dimenfix dimensionality reduction.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

        <span class="c1"># scatter original  labels</span>
        <span class="n">label_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="s2">&quot;#</span><span class="si">{:06x}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0xFFFFFF</span><span class="p">))</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">}</span>
        <span class="n">point_colors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">label</span><span class="p">:</span> <span class="n">label_colors</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">all_labels</span><span class="p">))</span>
        <span class="n">scatter_labeled</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">point_colors</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># scatter Rg labels</span>
        <span class="n">rg_labeled</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span> <span class="p">[</span><span class="n">rg</span> <span class="k">for</span> <span class="n">rg</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">rg</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> 
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">rg_labeled</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>

        <span class="c1"># scatter cluster label</span>
        
        
        <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">sil_scores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">)</span>
        <span class="n">scatter</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>

        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Scatter plot (original labels)&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Scatter plot (clustering labels)&#39;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Scatter plot (Rg labels)&#39;</span><span class="p">)</span>


        <span class="c1">#manage legends</span>
        <span class="n">legend_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">label_colors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">legend_handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">label_colors</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">legend_labels</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_handles</span><span class="p">,</span> <span class="n">legend_labels</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Origanl Labels&#39;</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="s1">&#39;lower left&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">plot_dir</span>  <span class="o">+</span> <span class="s1">&#39;/dimenfix_scatter.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span></div>


        <span class="c1">#return fig</span>
        
        


    <span class="c1"># def dimenfix_scatter_plot_rg(analysis, save=False):</span>
    <span class="c1">#     fig, ax = plt.subplots(figsize=(10, 6))</span>
    <span class="c1">#     scatter = ax.scatter(analysis.transformed_data[:, 0], analysis.transformed_data[:, 1], c=analysis.rg, cmap=&#39;viridis&#39;, s=10)</span>
    <span class="c1">#     fig.colorbar(scatter, ax=ax, label=&#39;Rg Numbers&#39;)</span>
    <span class="c1">#     ax.set_xlabel(&#39;Dimension 1&#39;)</span>
    <span class="c1">#     ax.set_ylabel(&#39;Dimension 2&#39;)</span>
    <span class="c1">#     ax.set_title(&#39;Scatter Plot&#39;)</span>

    <span class="c1">#     key = &quot;dimenfix_scatter_plot_rg&quot;</span>
    <span class="c1">#     if key not in self.figures:</span>
    <span class="c1">#             self.figures[key] = fig</span>

    <span class="c1">#     if save:</span>
    <span class="c1">#         plot_dir = os.path.join(analysis.data_dir, PLOT_DIR)</span>
    <span class="c1">#         plt.savefig(plot_dir  +&#39;/dimenfix_scatter_rg.png&#39;, dpi=800)</span>
    <span class="c1">#     return fig</span>

    <span class="c1"># def dimenfix_scatter_plot_ens(analysis, save=False):</span>
    <span class="c1">#     # Map unique labels to unique integer values</span>
    <span class="c1">#     label_to_int = {label: i for i, label in enumerate(np.unique(analysis.all_labels))}</span>
        
    <span class="c1">#     # Convert labels to corresponding integer values</span>
    <span class="c1">#     int_labels = np.array([label_to_int[label] for label in analysis.all_labels])</span>
        
    <span class="c1">#     # Create a colormap based on the number of unique labels</span>
    <span class="c1">#     cmap = plt.cm.get_cmap(&#39;viridis&#39;, len(label_to_int))</span>
        
    <span class="c1">#     fig, ax = plt.subplots(figsize=(10, 6))</span>
    <span class="c1">#     scatter = ax.scatter(analysis.transformed_data[:, 0], analysis.transformed_data[:, 1], c=int_labels, cmap=cmap, s=100)</span>
    <span class="c1">#     fig.colorbar(scatter, ax=ax, label=&#39;All Labels&#39;)</span>
    <span class="c1">#     ax.set_xlabel(&#39;Dimension 1&#39;)</span>
    <span class="c1">#     ax.set_ylabel(&#39;Dimension 2&#39;)</span>
    <span class="c1">#     ax.set_title(&#39;Scatter Plot 2&#39;)</span>

    <span class="c1">#     key = &quot;dimenfix_scatter_plot_ens&quot;</span>
    <span class="c1">#     if key not in self.figures:</span>
    <span class="c1">#             self.figures[key] = fig</span>

    <span class="c1">#     if save:</span>
    <span class="c1">#         plot_dir = os.path.join(analysis.data_dir, PLOT_DIR)</span>
    <span class="c1">#         plt.savefig(plot_dir  +&#39;/dimenfix_scatter_ens.png&#39;, dpi=800)</span>
    <span class="c1">#     return fig</span>



    <span class="c1"># def dimenfix_cluster_scatter_plot(analysis, save=False):</span>
    <span class="c1">#     n_clusters = s_max(analysis.reducer.sil_scores)</span>

    <span class="c1">#     kmeans = KMeans(n_clusters=n_clusters, random_state=42)</span>
    <span class="c1">#     labels = kmeans.fit_predict(analysis.transformed_data)</span>

    <span class="c1">#     fig, ax = plt.subplots(figsize=(10, 6))</span>
        
    <span class="c1">#     # Plot the points with different colors for each cluster</span>
    <span class="c1">#     scatter = ax.scatter(analysis.transformed_data[:, 0], analysis.transformed_data[:, 1], s=3, c=labels, cmap=&#39;viridis&#39;)</span>
    <span class="c1">#     ax.set_title(&#39;K-means Clustering&#39;)</span>
        
    <span class="c1">#     # Create colorbar</span>
    <span class="c1">#     cbar = fig.colorbar(scatter, ax=ax)</span>
    <span class="c1">#     cbar.set_label(&#39;Cluster Labels&#39;)</span>

    <span class="c1">#     key = &quot;dimenfix_cluster_scatter_plot&quot;</span>
    <span class="c1">#     if key not in self.figures:</span>
    <span class="c1">#             self.figures[key] = fig</span>

    <span class="c1">#     if save:</span>
    <span class="c1">#         plot_dir = os.path.join(analysis.data_dir, PLOT_DIR)</span>
    <span class="c1">#         plt.savefig(plot_dir  +&#39;/dimenfix_cluster_scatter.png&#39;, dpi=800)</span>
    <span class="c1">#     return fig</span>

    <span class="c1"># def dimenfix_cluster_scatter_plot_2(analysis, save=False):</span>
    <span class="c1">#     label_colors = {label: &quot;#{:06x}&quot;.format(random.randint(0, 0xFFFFFF)) for label in analysis.ens_codes}</span>
    <span class="c1">#     point_colors = list(map(lambda label: label_colors[label], analysis.all_labels))</span>

    <span class="c1">#     n_clusters = s_max(analysis.reducer.sil_scores)</span>

    <span class="c1">#     # Apply K-means clustering</span>
    <span class="c1">#     kmeans = KMeans(n_clusters=n_clusters, random_state=42)</span>
    <span class="c1">#     labels = point_colors</span>

    <span class="c1">#     # Create the figure and axis objects</span>
    <span class="c1">#     fig, ax = plt.subplots(figsize=(10, 6), dpi=100)</span>
        
    <span class="c1">#     # Plot the points with different colors for each cluster</span>
    <span class="c1">#     scatter = ax.scatter(analysis.transformed_data[:, 0], analysis.transformed_data[:, 1], c=labels, s=7)</span>
    <span class="c1">#     ax.set_title(&#39;K-means Clustering&#39;)</span>
        
    <span class="c1">#     # Create legend</span>
    <span class="c1">#     legend_labels = list(label_colors.keys())</span>
    <span class="c1">#     legend_handles = [plt.Line2D([0], [0], marker=&#39;o&#39;, color=&#39;w&#39;, markerfacecolor=label_colors[label], markersize=10) for label in legend_labels]</span>
    <span class="c1">#     ax.legend(legend_handles, legend_labels, title=&#39;Original Labels&#39;, loc=&#39;upper left&#39;, bbox_to_anchor=(1, 1))</span>

    <span class="c1">#     key = &quot;dimenfix_cluster_scatter_plot_2&quot;</span>
    <span class="c1">#     if key not in self.figures:</span>
    <span class="c1">#             self.figures[key] = fig</span>

    <span class="c1">#     if save:</span>
    <span class="c1">#         plot_dir = os.path.join(analysis.data_dir, PLOT_DIR)</span>
    <span class="c1">#         plt.savefig(plot_dir  +&#39;/dimenfix_cluster_scatter_2.png&#39;, dpi=800)</span>
    <span class="c1">#     return fig</span>

<div class="viewcode-block" id="Visualization.pca_cumulative_explained_variance">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.pca_cumulative_explained_variance">[docs]</a>
    <span class="k">def</span> <span class="nf">pca_cumulative_explained_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the cumulative variance. Only applicable when the</span>
<span class="sd">        dimensionality reduction method is &quot;pca&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">!=</span> <span class="s2">&quot;pca&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for pca dimensionality reduction.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_model</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;PCA dimension&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative explained variance %&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Cumulative Explained Variance by PCA Dimension&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">first_three_variance</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_model</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;First three: </span><span class="si">{</span><span class="n">first_three_variance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;PCA_variance&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">featurization</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

        <span class="c1">#return fig</span>

<div class="viewcode-block" id="Visualization.set_labels">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.set_labels">[docs]</a>
    <span class="k">def</span> <span class="nf">set_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">reduce_dim_method</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_y</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reduce_dim_method</span><span class="si">}</span><span class="s2"> dim </span><span class="si">{</span><span class="n">dim_x</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reduce_dim_method</span><span class="si">}</span><span class="s2"> dim </span><span class="si">{</span><span class="n">dim_y</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Visualization.pca_plot_2d_landscapes">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.pca_plot_2d_landscapes">[docs]</a>
    <span class="k">def</span> <span class="nf">pca_plot_2d_landscapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot 2D landscapes when the dimensionality reduction method </span>
<span class="sd">        is &quot;pca&quot; or &quot;kpca&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;pca&quot;</span><span class="p">,</span><span class="s2">&quot;kpca&quot;</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for pca dimensionality reduction.&quot;</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c1"># 2d scatters.</span>
        <span class="n">dim_x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dim_y</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
        <span class="n">legend_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
                        <span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
                        <span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>

        <span class="c1"># Plot all ensembles at the same time.</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">)),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">reduce_dim_data</span><span class="p">[:,</span><span class="n">dim_x</span><span class="p">],</span>
                        <span class="n">ensemble</span><span class="o">.</span><span class="n">reduce_dim_data</span><span class="p">[:,</span><span class="n">dim_y</span><span class="p">],</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">ens_code</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;pca&quot;</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_y</span><span class="p">)</span>

        <span class="c1"># Concatenate all reduced dimensionality data from the dictionary</span>
        <span class="n">all_data</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span>

        <span class="c1"># Plot each ensembles.</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ens_code</span><span class="p">)</span>
            <span class="c1"># Plot all data in gray</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">all_data</span><span class="p">[:,</span> <span class="n">dim_x</span><span class="p">],</span>
                            <span class="n">all_data</span><span class="p">[:,</span> <span class="n">dim_y</span><span class="p">],</span>
                            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                            <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
            <span class="c1"># Plot ensemble data in color</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">reduce_dim_data</span><span class="p">[:,</span><span class="n">dim_x</span><span class="p">],</span>
                            <span class="n">ensemble</span><span class="o">.</span><span class="n">reduce_dim_data</span><span class="p">[:,</span><span class="n">dim_y</span><span class="p">],</span>
                            <span class="n">label</span><span class="o">=</span><span class="n">ens_code</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_labels</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;pca&quot;</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_y</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;PCA&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">featurization</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

        <span class="c1">#plt.show()</span>
        <span class="c1">#return fig</span>

<div class="viewcode-block" id="Visualization.pca_plot_1d_histograms">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.pca_plot_1d_histograms">[docs]</a>
    <span class="k">def</span> <span class="nf">pca_plot_1d_histograms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot 1D histogram when the dimensionality reduction method </span>
<span class="sd">        is &quot;pca&quot; or &quot;kpca&quot;</span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">!=</span> <span class="s2">&quot;pca&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for pca dimensionality reduction.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        
        <span class="n">n_bins</span> <span class="o">=</span> <span class="mi">30</span>

        <span class="n">dpi</span> <span class="o">=</span> <span class="mi">120</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">)),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                        <span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                        <span class="n">n_bins</span><span class="p">)</span>
        
        <span class="c1"># Ensure ax is always a list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">reduce_dim_data</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">ens_code</span><span class="p">,</span>
                    <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                    <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span>
                    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
                    <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                    <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                    <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
                        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span>
                        <span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dim </span><span class="si">{</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;PCA_hist&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">featurization</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

        <span class="c1">#plt.show()</span>
        <span class="c1">#return fig</span>

<div class="viewcode-block" id="Visualization.pca_correlation_plot">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.pca_correlation_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">pca_correlation_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_residues</span><span class="p">,</span> <span class="n">sel_dims</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">!=</span> <span class="s2">&quot;pca&quot;</span> <span class="ow">or</span> <span class="n">analysis</span><span class="o">.</span><span class="n">featurization</span> <span class="o">!=</span> <span class="s2">&quot;ca_dist&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for pca dimensionality reduction with ca_dist feature extraction.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;RdBu&quot;</span><span class="p">)</span>  <span class="c1"># RdBu, PiYG</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="o">-</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">)</span>  <span class="c1"># NOTE: this range should be adapted</span>
                                            <span class="c1"># when analyzing other systems via PCA!</span>
        <span class="n">dpi</span> <span class="o">=</span> <span class="mi">120</span>

        <span class="n">fig_r</span> <span class="o">=</span> <span class="mf">0.8</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="o">*</span><span class="n">fig_r</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">fig_r</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">sel_dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sel_dims</span><span class="p">):</span>
            <span class="n">feature_ids_sorted_by_weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_model</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">sel_dim</span><span class="p">,:])))</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_residues</span><span class="p">,</span> <span class="n">num_residues</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">feature_ids_sorted_by_weight</span><span class="p">:</span>
                <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">feature_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                <span class="c1"># Note: this should be patched for proteins with resSeq values not starting from 1!</span>
                <span class="n">matrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">r2</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_model</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">sel_dim</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">matrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">r2</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_model</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">sel_dim</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>  <span class="c1"># RdBu, PiYG</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Residue j&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Residue i&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Weight of $d_</span><span class="si">{ij}</span><span class="s2">$&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; for PCA dim </span><span class="si">{</span><span class="n">sel_dim</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
                <span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;PCA weight&quot;</span>
            <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;PCA_correlation&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">featurization</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

        <span class="c1">#plt.show()</span>


<div class="viewcode-block" id="Visualization.pca_rg_correlation">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.pca_rg_correlation">[docs]</a>
    <span class="k">def</span> <span class="nf">pca_rg_correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examine and plot the correlation between PC dimension 1 and the amount of Rg</span>
<span class="sd">        Typically high correlation can be detected here. </span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">!=</span> <span class="s2">&quot;pca&quot;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for pca dimensionality reduction.&quot;</span><span class="p">)</span>
                <span class="k">return</span>
        
        <span class="n">dpi</span> <span class="o">=</span> <span class="mi">120</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">)),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">pca_dim</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Ensure ax is always a list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">rg_i</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_rg</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">reduce_dim_data</span><span class="p">[:,</span><span class="n">pca_dim</span><span class="p">],</span>
                    <span class="n">rg_i</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ens_code</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dim </span><span class="si">{</span><span class="n">pca_dim</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Rg [nm]&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">,</span><span class="s1">&#39;PCA_RG&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

        <span class="c1">#plt.show()</span>
        <span class="c1">#return fig</span>

<div class="viewcode-block" id="Visualization.plot_global_sasa">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_global_sasa">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_global_sasa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">showmeans</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">showmedians</span><span class="o">=</span><span class="kc">True</span> <span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the distribution of SASA for each conformation </span>
<span class="sd">        within the ensembles.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True the plot will be saved in the data directory. Default is False.</span>

<span class="sd">        showmean: bool</span>
<span class="sd">            if True it will show the mean </span>

<span class="sd">        showmedian: bool</span>
<span class="sd">            if True it will show the median</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dist_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ens</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">trajectories</span><span class="p">:</span>
            <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ens</span><span class="p">)</span>
            <span class="n">sasa</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">shrake_rupley</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">trajectories</span><span class="p">[</span><span class="n">ens</span><span class="p">])</span>
            <span class="n">total_sasa</span> <span class="o">=</span> <span class="n">sasa</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dist_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_sasa</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">dist_list</span><span class="p">,</span> <span class="n">showmeans</span><span class="o">=</span><span class="n">showmeans</span><span class="p">,</span> <span class="n">showmedians</span><span class="o">=</span><span class="n">showmedians</span>  <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">))],</span><span class="n">labels</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mf">45.0</span><span class="p">,</span> <span class="n">ha</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;SASA distribution over the ensembles&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;SASA (nm)^2&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">,</span><span class="s1">&#39;Global_SASA_dist&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

        <span class="c1"># plt.legend()</span>
        <span class="c1"># plt.show()</span>

<div class="viewcode-block" id="Visualization.plot_rg_vs_asphericity">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_rg_vs_asphericity">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_rg_vs_asphericity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the Rg versus Asphericity and gives the pearson correlation coefficient to evaluate </span>
<span class="sd">        the correlation between Rg and Asphericity. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>
        
        <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_rg</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">calculate_asphericity</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_gyration_tensor</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">))</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">x</span> <span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">ens_code</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pearson coeff for </span><span class="si">{</span><span class="n">ens_code</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Asphericity&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Rg [nm]&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">,</span><span class="s1">&#39;Rg_vs_Asphericity&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

        <span class="c1"># plt.show()</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def trajectories_plot_density(trajectories):</span>
<span class="sd">        for ens in trajectories:</span>
<span class="sd">            asphericity = calculate_asphericity(mdtraj.compute_gyration_tensor(trajectories[ens]))</span>
<span class="sd">            sns.kdeplot(asphericity, label = ens)</span>
<span class="sd">        plt.legend()</span>
<span class="sd">        plt.show()</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def trajectories_plot_density(trajectories):</span>
<span class="sd">        fig, ax = plt.subplots()</span>
<span class="sd">        for ens in trajectories:</span>
<span class="sd">            asphericity = calculate_asphericity(mdtraj.compute_gyration_tensor(trajectories[ens]))</span>
<span class="sd">            # sns.kdeplot(asphericity, label = ens)</span>
<span class="sd">            kde = gaussian_kde(asphericity)</span>
<span class="sd">            x = np.linspace(min(asphericity), max(asphericity), 100)</span>
<span class="sd">            ax.plot(x, kde(x), label=ens)</span>
<span class="sd">        ax.legend()</span>
<span class="sd">        ax.set_xlabel(&#39;Asphericity&#39;)</span>
<span class="sd">        ax.set_ylabel(&#39;Density&#39;)</span>
<span class="sd">        ax.set_title(&#39;Kernel Density Estimate of Asphericity for Trajectories&#39;)</span>
<span class="sd">        plt.show()</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="Visualization.plot_rg_vs_prolateness">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_rg_vs_prolateness">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_rg_vs_prolateness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the Rg versus Prolateness and gives the pearson correlation coefficient to evaluate </span>
<span class="sd">        the correlation between Rg and Prolateness. </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">rg</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">calculate_prolateness</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_gyration_tensor</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">))</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">x</span> <span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">ens_code</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pearson coeff for </span><span class="si">{</span><span class="n">ens_code</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;prolateness&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Rg [nm]&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">,</span><span class="s1">&#39;Rg_vs_Prolateness&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

        <span class="c1"># plt.show()</span>

<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def trajectories_plot_prolateness(trajectories):</span>
<span class="sd">        for ens in trajectories:</span>
<span class="sd">            prolatness = calculate_prolateness(mdtraj.compute_gyration_tensor(trajectories[ens]))</span>
<span class="sd">            sns.kdeplot(prolatness, label = ens)</span>
<span class="sd">        plt.legend()</span>
<span class="sd">        plt.show()</span>
<span class="sd">    &#39;&#39;&#39;</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def trajectories_plot_prolateness(trajectories):</span>
<span class="sd">        fig, ax = plt.subplots()</span>
<span class="sd">        for ens in trajectories:</span>
<span class="sd">            prolatness = calculate_prolateness(mdtraj.compute_gyration_tensor(trajectories[ens]))</span>
<span class="sd">            # sns.kdeplot(asphericity, label = ens)</span>
<span class="sd">            kde = gaussian_kde(prolatness)</span>
<span class="sd">            x = np.linspace(min(prolatness), max(prolatness), 100)</span>
<span class="sd">            ax.plot(x, kde(x), label=ens)</span>
<span class="sd">        ax.legend()</span>
<span class="sd">        ax.set_xlabel(&#39;Prolateness&#39;)</span>
<span class="sd">        ax.set_ylabel(&#39;Density&#39;)</span>
<span class="sd">        ax.set_title(&#39;Kernel Density Estimate of Prolateness for Trajectories&#39;)</span>
<span class="sd">        plt.show()</span>
<span class="sd">    &#39;&#39;&#39;</span>

<div class="viewcode-block" id="Visualization.plot_alpha_angle_dihederal">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_alpha_angle_dihederal">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_alpha_angle_dihederal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        
        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">four_cons_indices_ca</span> <span class="o">=</span> <span class="n">create_consecutive_indices_matrix</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">atom_selector</span><span class="p">)</span> <span class="p">)</span>
            <span class="n">ens_dh_ca</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_dihedrals</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">four_cons_indices_ca</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ens_dh_ca</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ens_code</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;the distribution of dihedral angles between four consecutive Cα beads.&quot;</span><span class="p">)</span>    
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">,</span><span class="s1">&#39;alpha_angle_dihederal&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

        <span class="c1"># plt.show</span>

<div class="viewcode-block" id="Visualization.get_protein_dssp_data_dict">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.get_protein_dssp_data_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">get_protein_dssp_data_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">dssp_data_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dssp_data_dict</span><span class="p">[</span><span class="n">ens_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_dssp</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dssp_data_dict</span></div>


<div class="viewcode-block" id="Visualization.plot_relative_helix_content">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_relative_helix_content">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_relative_helix_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the relative helix content in each ensemble for each residue. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">exists_coarse_grained</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This analysis is not possible with coarse-grained models.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">protein_dssp_data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_protein_dssp_data_dict</span><span class="p">()</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">protein_dssp_data_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">protein_name</span><span class="p">,</span> <span class="n">dssp_data</span> <span class="ow">in</span> <span class="n">protein_dssp_data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Count the occurrences of &#39;H&#39; in each column</span>
            <span class="n">h_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">dssp_data</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            
            <span class="c1"># Calculate the total number of residues for each position</span>
            <span class="n">total_residues</span> <span class="o">=</span> <span class="n">dssp_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c1"># Calculate the relative content of &#39;H&#39; for each residue</span>
            <span class="n">relative_h_content</span> <span class="o">=</span> <span class="n">h_counts</span> <span class="o">/</span> <span class="n">total_residues</span>
            
            <span class="c1"># Plot the relative content for each protein</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">relative_h_content</span><span class="p">)),</span> <span class="n">relative_h_content</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span> <span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">protein_name</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>

            <span class="n">bottom</span> <span class="o">+=</span> <span class="n">relative_h_content</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Residue Index&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Relative Content of H (Helix)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Relative Content of H in Each Residue in the ensembles&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;lower left&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Visualization.get_rg_data_dict">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.get_rg_data_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">get_rg_data_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">rg_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">rg_dict</span><span class="p">[</span><span class="n">ens_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_rg</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rg_dict</span></div>


<div class="viewcode-block" id="Visualization.trajectories_plot_rg_comparison">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.trajectories_plot_rg_comparison">[docs]</a>
    <span class="k">def</span> <span class="nf">trajectories_plot_rg_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">bins_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">96</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the distribution of the Rg whithin each ensemble</span>
<span class="sd">        </span>
<span class="sd">        Parameter </span>
<span class="sd">        ---------</span>
<span class="sd">        n_bins : int </span>
<span class="sd">        bins_range : tuple</span>
<span class="sd">        change the Rg scale in x-axis </span>
<span class="sd">        dpi : int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rg_data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rg_data_dict</span><span class="p">()</span>
        <span class="n">h_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;histtype&quot;</span><span class="p">:</span> <span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="n">n_systems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rg_data_dict</span><span class="p">)</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">bins_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bins_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">n_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_systems</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">n_systems</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        
        <span class="c1"># Ensure ax is always a list</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name_i</span><span class="p">,</span> <span class="n">rg_i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rg_data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rg_i</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name_i</span><span class="p">,</span> <span class="o">**</span><span class="n">h_args</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name_i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Rg [nm]&quot;</span><span class="p">)</span>
            <span class="n">mean_rg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rg_i</span><span class="p">)</span>
            <span class="n">median_rg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rg_i</span><span class="p">)</span>

            <span class="n">mean_line</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_rg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">median_line</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">median_rg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        
        <span class="n">mean_legend</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">)</span>
        <span class="n">median_legend</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Median&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="p">[</span><span class="n">mean_legend</span><span class="p">,</span> <span class="n">median_legend</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Visualization.get_distance_matrix_ens_dict">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.get_distance_matrix_ens_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">get_distance_matrix_ens_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">distance_matrix_ens_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">atom_selector</span>
            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span>
            <span class="n">xyz_ens</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">xyz</span><span class="p">[:,</span><span class="n">trajectory</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selector</span><span class="p">)]</span>
            <span class="n">distance_matrix_ens_dict</span><span class="p">[</span><span class="n">ens_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_distance_matrix</span><span class="p">(</span><span class="n">xyz_ens</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">distance_matrix_ens_dict</span></div>


<div class="viewcode-block" id="Visualization.get_contact_ens_dict">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.get_contact_ens_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">get_contact_ens_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">distance_matrix_ens_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">contact_ens_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
            <span class="n">xyz_ens</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">xyz</span><span class="p">[:,</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">atom_selector</span><span class="p">)]</span>
            <span class="n">distance_matrix_ens_dict</span><span class="p">[</span><span class="n">ens_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_distance_matrix</span><span class="p">(</span><span class="n">xyz_ens</span><span class="p">)</span>
            <span class="n">contact_ens_dict</span><span class="p">[</span><span class="n">ens_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_contact_map</span><span class="p">(</span><span class="n">distance_matrix_ens_dict</span><span class="p">[</span><span class="n">ens_code</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">contact_ens_dict</span></div>


<div class="viewcode-block" id="Visualization.plot_average_dmap_comparison">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_average_dmap_comparison">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_average_dmap_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                    <span class="n">ticks_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
                                    <span class="n">cbar_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
                                    <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
                                    <span class="n">dpi</span><span class="o">=</span><span class="mi">96</span><span class="p">,</span>
                                    <span class="n">max_d</span><span class="o">=</span><span class="mf">6.8</span><span class="p">,</span>
                                    <span class="n">use_ylabel</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the average distance maps for selected ensembles.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ticks_fontsize: int</span>
<span class="sd">        cbar_fontsize: int</span>
<span class="sd">        title_fontsize: int</span>
<span class="sd">        dpi: int</span>
<span class="sd">        max_d: float</span>
<span class="sd">            The maximum amount for distance the default value is 6.8</span>
<span class="sd">        use_ylabel: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ens_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distance_matrix_ens_dict</span><span class="p">()</span>
        <span class="n">num_proteins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ens_dict</span><span class="p">)</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Number of columns for subplots</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_proteins</span> <span class="o">+</span> <span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">cols</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">cols</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">rows</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>  <span class="c1"># Reshape axes to ensure it&#39;s 2D</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">protein_name</span><span class="p">,</span> <span class="n">ens_data</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ens_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">cols</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">cols</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="c1"># if num_proteins &gt; 1 else axes[0]</span>
            
            <span class="n">avg_dmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ens_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">tril_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril_indices</span><span class="p">(</span><span class="n">avg_dmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">avg_dmap</span><span class="p">[</span><span class="n">tril_ids</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
            <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">avg_dmap</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average Distance Map: </span><span class="si">{</span><span class="n">protein_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticks_fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_ylabel</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Average $d_</span><span class="si">{ij}</span><span class="s2">$ [nm]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">cbar_fontsize</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">cbar_fontsize</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">max_d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">im</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_d</span><span class="p">)</span>
        
        <span class="c1"># Remove any empty subplots</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_proteins</span><span class="p">,</span> <span class="n">rows</span> <span class="o">*</span> <span class="n">cols</span><span class="p">):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Visualization.plot_cmap_comparison">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_cmap_comparison">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_cmap_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                            <span class="n">title</span><span class="p">,</span>
                            <span class="n">ticks_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
                            <span class="n">cbar_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
                            <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
                            <span class="n">dpi</span><span class="o">=</span><span class="mi">96</span><span class="p">,</span>
                            <span class="n">cmap_min</span><span class="o">=-</span><span class="mf">3.5</span><span class="p">,</span>
                            <span class="n">use_ylabel</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">cmap_ens_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contact_ens_dict</span><span class="p">()</span>
        <span class="n">num_proteins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmap_ens_dict</span><span class="p">)</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Number of columns for subplots</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_proteins</span> <span class="o">+</span> <span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">cols</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">cols</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">rows</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">))</span>  <span class="c1"># Reshape axes to ensure it&#39;s 2D</span>
        
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;jet&quot;</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">cmap_min</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">protein_name</span><span class="p">,</span> <span class="n">cmap_ens</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cmap_ens_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">cols</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">cols</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="k">if</span> <span class="n">num_proteins</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="n">cmap_ens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cmap_ens</span><span class="p">)</span>
            <span class="n">cmap_ens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">cmap_ens</span><span class="p">)</span>
            
            <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cmap_ens</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contact Probability Map: </span><span class="si">{</span><span class="n">protein_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticks_fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_ylabel</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$log_</span><span class="si">{10}</span><span class="s1">(p_</span><span class="si">{ij}</span><span class="s1">)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">cbar_fontsize</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">cbar_fontsize</span><span class="p">)</span>
            
            <span class="n">im</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="n">cmap_min</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># Remove any empty subplots</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_proteins</span><span class="p">,</span> <span class="n">rows</span> <span class="o">*</span> <span class="n">cols</span><span class="p">):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Visualization.plot_distance_distribution_multiple">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_distance_distribution_multiple">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_distance_distribution_multiple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">96</span><span class="p">):</span>
        <span class="n">prot_data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_distance_matrix_ens_dict</span><span class="p">()</span>
        <span class="n">num_proteins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prot_data_dict</span><span class="p">)</span>
        
        <span class="c1"># Set up the subplot grid</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Number of columns for subplots</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_proteins</span> <span class="o">+</span> <span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">cols</span>
        
        <span class="c1"># Create the figure and subplots</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">rows</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        
        <span class="c1"># Flatten and plot the distance distribution for each protein</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">protein_name</span><span class="p">,</span> <span class="n">distance_matrix</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">prot_data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">cols</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">cols</span>
            
            <span class="n">distances_flat</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            
            <span class="c1"># Plot histogram</span>
            <span class="n">axes_flat</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Flatten axes to access them with a single index</span>
            <span class="n">axes_flat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">distances_flat</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">axes_flat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Protein </span><span class="si">{</span><span class="n">protein_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">axes_flat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Distance [nm]&#39;</span><span class="p">)</span>
            <span class="n">axes_flat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Density&#39;</span><span class="p">)</span>
            <span class="n">axes_flat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1"># Remove any empty subplots</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_proteins</span><span class="p">,</span> <span class="n">rows</span> <span class="o">*</span> <span class="n">cols</span><span class="p">):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span>
        
        <span class="c1"># Adjust layout</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Visualization.end_to_end_distances_plot">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.end_to_end_distances_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">end_to_end_distances_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">violin_plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">means</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">median</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot end-to-end distance distributions. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        atom_selector: str </span>
<span class="sd">            The type of atom considered for calculating end-to-end distance</span>

<span class="sd">        bins: int</span>
<span class="sd">            The number of bins for bar plot </span>

<span class="sd">        violin_plot: bool </span>
<span class="sd">            If True box plot is visualized</span>

<span class="sd">        means: bool</span>
<span class="sd">            If True mean is showing in the box plot </span>

<span class="sd">        median: bool</span>
<span class="sd">            If True median is showing in the box plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">dist_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">violin_plot</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">ca_indices</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">atom_selector</span><span class="p">)</span>
                <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ens_code</span><span class="p">)</span>
                <span class="n">dist_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_distances</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,[[</span><span class="n">ca_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ca_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]])</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">dist_list</span><span class="p">,</span> <span class="n">showmeans</span><span class="o">=</span> <span class="n">means</span><span class="p">,</span> <span class="n">showmedians</span><span class="o">=</span> <span class="n">median</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">))],</span><span class="n">labels</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mf">45.0</span><span class="p">,</span> <span class="n">ha</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;End-to-End distance [nm]&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;End-to-End distances distribution&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_distances</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,[[</span><span class="n">ca_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ca_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                    <span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ens_code</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;End-to-End distances distribution&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>    </div>


<div class="viewcode-block" id="Visualization.plot_asphericity_dist">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_asphericity_dist">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_asphericity_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">violin_plot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">means</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">median</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot asphericity distribution in each ensemble.</span>
<span class="sd">        Asphericity is calculated based on the gyration tensor.  </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        bins: int</span>
<span class="sd">            The number of bins for bar plot </span>
<span class="sd">        violint_plot: bool </span>
<span class="sd">            If True box plot is visualized</span>

<span class="sd">        means: bool</span>
<span class="sd">            If True mean is showing in the box plot </span>

<span class="sd">        median: bool</span>
<span class="sd">            If True median is showing in the box plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">asph_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">violin_plot</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">asphericity</span> <span class="o">=</span> <span class="n">calculate_asphericity</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_gyration_tensor</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">))</span>
                <span class="n">asph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asphericity</span><span class="p">)</span>
                <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ens_code</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">asph_list</span><span class="p">,</span> <span class="n">showmeans</span><span class="o">=</span><span class="n">means</span><span class="p">,</span> <span class="n">showmedians</span><span class="o">=</span> <span class="n">median</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">))],</span><span class="n">labels</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mf">45.0</span><span class="p">,</span> <span class="n">ha</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Asphericity&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Asphericity distribution&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ens_code</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">asphericity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ens_code</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Asphericity distribution&quot;</span><span class="p">)</span>        
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Visualization.plot_prolateness_dist">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_prolateness_dist">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_prolateness_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">violin_plot</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">median</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="kc">False</span>  <span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot prolateness distribution in each ensemble.</span>
<span class="sd">        Prolateness is calculated based on the gyration tensor.  </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        bins: int</span>
<span class="sd">            The number of bins for bar plot </span>
<span class="sd">        violint_plot: bool </span>
<span class="sd">            If True box plot is visualized</span>

<span class="sd">        means: bool</span>
<span class="sd">            If True mean is showing in the box plot </span>

<span class="sd">        median: bool</span>
<span class="sd">            If True median is showing in the box plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">prolat_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">violin_plot</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">prolat</span> <span class="o">=</span> <span class="n">calculate_prolateness</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_gyration_tensor</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">))</span>
                <span class="n">prolat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prolat</span><span class="p">)</span>
                <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ens_code</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">prolat_list</span><span class="p">,</span> <span class="n">showmeans</span><span class="o">=</span> <span class="n">mean</span><span class="p">,</span> <span class="n">showmedians</span><span class="o">=</span> <span class="n">median</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">positions</span><span class="p">))],</span><span class="n">labels</span><span class="o">=</span><span class="n">positions</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mf">45.0</span><span class="p">,</span> <span class="n">ha</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Prolateness&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Prolateness distribution&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ens_code</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">prolat</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ens_code</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Prolateness distribution&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Visualization.plot_alpha_angles_dist">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_alpha_angles_dist">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_alpha_angles_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span><span class="mi">50</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the distribution of alpha angles.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bins : int</span>
<span class="sd">            The number of bins for bar plot </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">featurize_a_angle</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">get_names</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">atom_selector</span><span class="o">=</span><span class="n">ensemble</span><span class="o">.</span><span class="n">atom_selector</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ens_code</span><span class="p">)</span>
            
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;the distribution of dihedral angles between four consecutive Cα beads.&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Visualization.plot_contact_prob">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_contact_prob">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_contact_prob</span><span class="p">(</span><span class="bp">self</span> <span class="p">,</span><span class="n">title</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span><span class="n">dpi</span> <span class="o">=</span> <span class="mi">96</span><span class="p">):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the contact probability map based on the threshold. </span>
<span class="sd">        The default value for threshold is 0.8[nm], </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        title: str </span>
<span class="sd">            You need to specify a title for the plot</span>

<span class="sd">        threshold: float</span>
<span class="sd">            Determing the threshold fo calculating the contact frequencies. default value is 0.8[nm]</span>

<span class="sd">        dpi: int</span>
<span class="sd">            For changing the quality and dimension of the output figure</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">exists_coarse_grained</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This analysis is not possible with coarse-grained models.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">num_proteins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ensembles</span><span class="p">)</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_proteins</span> <span class="o">+</span> <span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">cols</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">cols</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">rows</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;Blues&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">cols</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">cols</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="k">if</span> <span class="n">num_proteins</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">matrtix_p_map</span> <span class="o">=</span> <span class="n">contact_probability_map</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span> <span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">matrtix_p_map</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span> <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contact Probability Map: </span><span class="si">{</span><span class="n">ens_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>


            <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_proteins</span><span class="p">,</span> <span class="n">rows</span> <span class="o">*</span> <span class="n">cols</span><span class="p">):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Visualization.plot_ramachandran_plot">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_ramachandran_plot">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_ramachandran_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">two_d_hist</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">linespaces</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">80</span><span class="p">)):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ramachandran plot. If two_d_hist= True it returns 2D histogram </span>
<span class="sd">        for each ensembles. If two_d_hist=False it returns a simple scatter plot </span>
<span class="sd">        for ell ensembles in one plot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        two_d_hist: bool</span>
<span class="sd">            If True it returns 2D histogram for each ensemble. </span>

<span class="sd">        linespaces: tuple</span>
<span class="sd">            You can customize the bins for 2D histogram</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="k">if</span> <span class="n">two_d_hist</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ensembles</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ensembles</span><span class="p">),</span> <span class="mi">5</span><span class="p">))</span>
            <span class="n">rama_linspace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">linespaces</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linespaces</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">linespaces</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">ens</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ensembles</span><span class="p">,</span> <span class="n">axes</span><span class="o">.</span><span class="n">ravel</span><span class="p">()):</span>
                <span class="n">phi_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_phi</span><span class="p">(</span><span class="n">ensembles</span><span class="p">[</span><span class="n">ens</span><span class="p">]</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">psi_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_psi</span><span class="p">(</span><span class="n">ensembles</span><span class="p">[</span><span class="n">ens</span><span class="p">]</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">hist</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span>
                <span class="n">phi_flat</span><span class="p">,</span>
                <span class="n">psi_flat</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
                <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">rama_linspace</span><span class="p">,</span> <span class="n">rama_linspace</span><span class="p">),</span> 
                <span class="n">norm</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span>
                <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ramachandran Plot for cluster </span><span class="si">{</span><span class="n">ens</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Phi (ϕ) Angle (degrees)&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Psi (ψ) Angle (degrees)&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ens</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_phi</span><span class="p">(</span><span class="n">ensembles</span><span class="p">[</span><span class="n">ens</span><span class="p">]</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_psi</span><span class="p">(</span><span class="n">ensembles</span><span class="p">[</span><span class="n">ens</span><span class="p">]</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">ens</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Phi (ϕ) Angle (degrees)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Psi (ψ) Angle (degrees)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;lower left&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Visualization.plot_ss_measure_disorder">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_ss_measure_disorder">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_ss_measure_disorder</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">pointer</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">)):</span>
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate site specific flexibility parameter plot. Further information is available in</span>
<span class="sd">        this paper by G.Jeschke https://onlinelibrary.wiley.com/doi/epdf/10.1002/pro.4906. </span>
<span class="sd">        In summary this score is sensitive to local flexibility based on the circular variance of the</span>
<span class="sd">        Ramachandran angles φ and ψ for each residue in the ensemble.</span>

<span class="sd">        This score ranges from 0 for identical dihederal angles for all conformers at the residue i to 1 </span>
<span class="sd">        for a uniform distribution of dihederal angles at the residue i. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pointer: list </span>
<span class="sd">            You can add the desired residues in a list and then you have a vertical dashed line to point those residues</span>

<span class="sd">        figsize:tuple</span>
<span class="sd">            You can change the size oof the figure here using a tuple. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Figure this out</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">perform_feature_extraction</span><span class="p">(</span><span class="s2">&quot;phi_psi&quot;</span><span class="p">)</span> <span class="c1"># extract phi_psi features to calculate this score</span>

        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">ss_measure_disorder</span><span class="p">(</span><span class="n">ensembles</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ensembles</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">key</span><span class="p">)</span>
        
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span>  <span class="n">i</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">i</span><span class="o">%</span><span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Residue Index&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Site-specific measure of disorder&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pointer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">pointer</span><span class="p">:</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span> <span class="n">res</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

            
<div class="viewcode-block" id="Visualization.plot_ss_order_parameter">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.plot_ss_order_parameter">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_ss_order_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pointer</span><span class="p">:</span><span class="nb">list</span><span class="o">=</span> <span class="kc">None</span> <span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="p">):</span> 
<span class="w">        </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate site specific order parameter plot. For further information</span>
<span class="sd">        you can check this paper by G.Jeschke https://onlinelibrary.wiley.com/doi/epdf/10.1002/pro.4906. </span>
<span class="sd">        In summary this score abstracts from local chain flexibility. The parameter is still site-specific, as orientation </span>
<span class="sd">        correlations in IDRs and IDPs decrease with increasing sequence distance. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pointer: list </span>
<span class="sd">            You can add the desired residues in a list and then you have a vertical dashed line to point those residues</span>

<span class="sd">        figsize:tuple</span>
<span class="sd">            You can change the size oof the figure here using a tuple. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">dict_ca_xyz</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ens_code</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ca_index</span><span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">atom_selector</span><span class="p">)</span>
            <span class="n">dict_ca_xyz</span><span class="p">[</span><span class="n">ens_code</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">xyz</span><span class="p">[:,</span><span class="n">ca_index</span><span class="p">,:]</span>

        <span class="n">dict_order_parameter</span> <span class="o">=</span> <span class="n">site_specific_order_parameter</span><span class="p">(</span><span class="n">dict_ca_xyz</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dict_order_parameter</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dict_order_parameter</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">dict_order_parameter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">axes</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span> <span class="n">key</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span>  <span class="n">i</span><span class="o">==</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">i</span><span class="o">%</span><span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Residue Index&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Site-specific order parameter&quot;</span><span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pointer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">pointer</span><span class="p">:</span>
                <span class="n">axes</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


    <span class="c1">#----------------------------------------------------------------------</span>
    <span class="c1">#------------- Functions for generating PDF reports -------------------</span>
    <span class="c1">#----------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_generate_tsne_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>
        <span class="n">pdf_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">,</span> <span class="s1">&#39;tsne.pdf&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">pdf_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">pdf</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">featurization</span> <span class="o">==</span> <span class="s2">&quot;phi_psi&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tsne_ramachandran_plot_density</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">tsne_scatter_plot</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plots saved to </span><span class="si">{</span><span class="n">pdf_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_dimenfix_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>
        <span class="n">pdf_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">,</span> <span class="s1">&#39;dimenfix.pdf&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">pdf_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">pdf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dimenfix_scatter</span><span class="p">()</span>
            <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plots saved to </span><span class="si">{</span><span class="n">pdf_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_pca_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>
        <span class="n">pdf_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">,</span> <span class="s1">&#39;pca.pdf&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">pdf_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">pdf</span><span class="p">:</span>
        
            <span class="bp">self</span><span class="o">.</span> <span class="n">pca_cumulative_explained_variance</span><span class="p">()</span>
            <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pca_plot_2d_landscapes</span><span class="p">()</span>
            <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pca_plot_1d_histograms</span><span class="p">()</span>
            <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pca_rg_correlation</span><span class="p">(</span><span class="n">analysis</span><span class="p">)</span>
            <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plots saved to </span><span class="si">{</span><span class="n">pdf_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Visualization.generate_custom_report">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.generate_custom_report">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_custom_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate pdf report with all plots that were explicitly called during the session.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>
        <span class="n">pdf_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">,</span> <span class="s1">&#39;custom_report.pdf&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">pdf_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">pdf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figures</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">pdf</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plots saved to </span><span class="si">{</span><span class="n">pdf_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Visualization.generate_report">
<a class="viewcode-back" href="../../dpet.html#dpet.visualization.Visualization.generate_report">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate pdf report with all plots relevant to the conducted analysis.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">==</span> <span class="s2">&quot;tsne&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_tsne_report</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">==</span> <span class="s2">&quot;dimenfix&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_dimenfix_report</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">==</span> <span class="s2">&quot;pca&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_generate_pca_report</span><span class="p">()</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Hamidreza Ghafouri, Giacomo Janson, Nikola Ivanović.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>