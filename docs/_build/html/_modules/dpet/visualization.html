<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dpet.visualization &mdash; Disordered Protein Ensemble Tools 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Disordered Protein Ensemble Tools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../demo.html">Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dm.html">dimensionality_reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dpet.ensemble_analysis.html">dpet.ensemble_analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ensemble.html">ensemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../visualization.html">visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dpet.featurization.html">dpet.featurization package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Disordered Protein Ensemble Tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">dpet.visualization</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for dpet.visualization</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span><span class="p">,</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">import</span> <span class="nn">mdtraj</span>
<span class="kn">from</span> <span class="nn">dpet.featurization.distances</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">dpet.ensemble_analysis</span> <span class="kn">import</span> <span class="n">EnsembleAnalysis</span>
<span class="kn">from</span> <span class="nn">dpet.featurization.angles</span> <span class="kn">import</span> <span class="n">featurize_a_angle</span>
<span class="kn">from</span> <span class="nn">dpet.data.coord</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">dpet.featurization.glob</span> <span class="kn">import</span> <span class="n">compute_asphericity</span><span class="p">,</span> <span class="n">compute_prolateness</span>

<span class="n">PLOT_DIR</span> <span class="o">=</span> <span class="s2">&quot;plots&quot;</span>

<div class="viewcode-block" id="plot_histogram"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.plot_histogram">[docs]</a><span class="k">def</span> <span class="nf">plot_histogram</span><span class="p">(</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">bins</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">List</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="nb">range</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Histogram&quot;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Density&quot;</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot an histogram for different features.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax: plt.Axes</span>
<span class="sd">        Matplotlib axis object where the histograms will be for plotted.</span>
<span class="sd">    data: List[np.array]</span>
<span class="sd">        List of NumPy array storing the data to be plotted.</span>
<span class="sd">    labels: List[str]</span>
<span class="sd">        List of strings with the labels of the arrays.</span>
<span class="sd">    bins:</span>
<span class="sd">        Number of bins.</span>
<span class="sd">    range: Tuple, optional</span>
<span class="sd">        A tuple with a min and max value for the histogram. Default is None,</span>
<span class="sd">        which corresponds to using the min a max value across all data.</span>
<span class="sd">    title: str, optional</span>
<span class="sd">        Title of the axis object.</span>
<span class="sd">    xlabel: str, optional</span>
<span class="sd">        Label of the horizontal axis.</span>
<span class="sd">    ylabel: str, optional</span>
<span class="sd">        Label of the vertical axis.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plt.Axes</span>
<span class="sd">        Axis objects for the histogram plot of original labels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">_bins</span> <span class="o">=</span> <span class="n">_get_hist_bins</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="nb">range</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">h_i</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">data_i</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">_bins</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">_bins</span><span class="p">,</span>
            <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">histtype</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span>
            <span class="c1"># edgecolor=&#39;black&#39;,</span>
            <span class="c1"># histtype=&#39;stepfilled&#39;,</span>
            <span class="c1"># alpha=0.25</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_bins</span> <span class="o">=</span> <span class="n">h_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span></div>

<span class="k">def</span> <span class="nf">_get_hist_bins</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">range</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>  <span class="c1"># Make a range.</span>
        <span class="k">if</span> <span class="nb">range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">x_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
            <span class="n">_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">x_i</span><span class="p">)</span> <span class="k">for</span> <span class="n">x_i</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_min</span> <span class="o">=</span> <span class="nb">range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">_max</span> <span class="o">=</span> <span class="nb">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">_min</span><span class="p">,</span> <span class="n">_max</span><span class="p">,</span> <span class="n">bins</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># The bins are already provided as a range.</span>
        <span class="n">_bins</span> <span class="o">=</span> <span class="n">bins</span>
    <span class="k">return</span> <span class="n">_bins</span>

<div class="viewcode-block" id="plot_violins"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.plot_violins">[docs]</a><span class="k">def</span> <span class="nf">plot_violins</span><span class="p">(</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
        <span class="n">labels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">means</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">median</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Histogram&quot;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make a violin plot.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax: plt.Axes</span>
<span class="sd">        Matplotlib axis object where the histograms will be for plotted.</span>
<span class="sd">    data: List[np.array]</span>
<span class="sd">        List of NumPy array storing the data to be plotted.</span>
<span class="sd">    labels: List[str]</span>
<span class="sd">        List of strings with the labels of the arrays.</span>
<span class="sd">    means : bool, optional</span>
<span class="sd">            If True, means are shown in the violin plot. Default is True.</span>
<span class="sd">    median : bool, optional</span>
<span class="sd">        If True, medians are shown in the violin plot. Default is True.</span>
<span class="sd">    title: str, optional</span>
<span class="sd">        Title of the axis object.</span>
<span class="sd">    xlabel: str, optional</span>
<span class="sd">        Label of the horizontal axis.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    plt.Axes</span>
<span class="sd">        Axis objects for the histogram plot of original labels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">showmeans</span><span class="o">=</span><span class="n">means</span><span class="p">,</span> <span class="n">showmedians</span><span class="o">=</span><span class="n">median</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mf">45.0</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="plot_comparison_matrix"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.plot_comparison_matrix">[docs]</a><span class="k">def</span> <span class="nf">plot_comparison_matrix</span><span class="p">(</span>
        <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span>
        <span class="n">scores</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">codes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">std</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">cmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;viridis_r&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;New Comparison&quot;</span><span class="p">,</span>
        <span class="n">cbar_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;score&quot;</span><span class="p">,</span>
        <span class="n">textcolors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a matrix with all vs all comparison scores as a heatmap.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ax: plt.Axes</span>
<span class="sd">        Axes object where the heatmap should be created.</span>
<span class="sd">    scores: np.ndarray</span>
<span class="sd">        NumPy array with shape (M, M, B) containing the comparison scores for M</span>
<span class="sd">        ensembles and B bootstrap iterations. See the documentation for the</span>
<span class="sd">        output of `EnsembleAnalysis.comparison_scores` for more information.</span>
<span class="sd">    codes: List[str]</span>
<span class="sd">        List of strings with the codes of the ensembles.</span>
<span class="sd">    std: bool, optional</span>
<span class="sd">        Show the standard deviation of the comparison scores over B bootstrap</span>
<span class="sd">        iterations for each of each score in the M x M matrix. Only takes effect</span>
<span class="sd">        if B &gt;= 2. Default is `False`.</span>
<span class="sd">    cmap: str, optional</span>
<span class="sd">        Matplotlib colormap name to use in the heatmap.</span>
<span class="sd">    title: str, optional</span>
<span class="sd">        Title of the heatmap.</span>
<span class="sd">    cbar_label: str, optional</span>
<span class="sd">        Label of the colorbar.</span>
<span class="sd">    textcolors: Union[str, tuple], optional</span>
<span class="sd">        Color of the text for each cell of the heatmap, specified as a string.</span>
<span class="sd">        By providing a tuple with two elements, the two colors will be applied</span>
<span class="sd">        to cells with color intensity above/below a certain threshold, so that</span>
<span class="sd">        ligher text can be plotted in darker cells and darker text can be</span>
<span class="sd">        plotted in lighter cells.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ax: plt.Axes</span>
<span class="sd">        The same updated Axes object from the input.</span>
<span class="sd">    </span>
<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The comparison matrix is annotated with the scores, and the axes are labeled</span>
<span class="sd">    with the ensemble labels.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scores_mean</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">scores</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">std</span><span class="p">:</span>
        <span class="c1"># More than 1 bootstrap iteration, can calculate std.</span>
        <span class="n">scores_err</span> <span class="o">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># One or less bootstrap iterations.</span>
        <span class="n">scores_err</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">scores_mean</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">codes</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">codes</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">codes</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span>

    <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.75</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">codes</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">codes</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">textcolors</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">color_ij</span> <span class="o">=</span> <span class="n">textcolors</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">color_ij</span> <span class="o">=</span> <span class="n">textcolors</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">scores_mean</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)]</span>
            <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">color_ij</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">scores_err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">label_ij</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scores_mean</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">scores_err</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label_ij</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scores_mean</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">label_ij</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span></div>


<div class="viewcode-block" id="Visualization"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization">[docs]</a><span class="k">class</span> <span class="nc">Visualization</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualization class for ensemble analysis.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        analysis (EnsembleAnalysis): An instance of EnsembleAnalysis providing data for visualization.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">analysis</span><span class="p">:</span> <span class="n">EnsembleAnalysis</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span> <span class="o">=</span> <span class="n">analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">PLOT_DIR</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_tsne_scatter</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">color_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rg&quot;</span><span class="p">,</span>
            <span class="n">kde_by_ensemble</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the results of t-SNE analysis. </span>

<span class="sd">        Three scatter plots will be generated based on original, clustering, and feature-colored points. </span>
<span class="sd">        One KDE density plot will also be generated to show the most populated areas in the reduced dimension.   </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        color_by: str, optional</span>
<span class="sd">            The feature extraction method used for coloring points in the scatter plot. Options are &quot;rg&quot;, &quot;prolateness&quot;, &quot;asphericity&quot;, &quot;sasa&quot;, and &quot;end_to_end&quot;. Default is &quot;rg&quot;.</span>
<span class="sd">        </span>
<span class="sd">        kde_by_ensemble: bool, optional</span>
<span class="sd">            If True, the KDE plot will be generated for each ensemble separately. If False, a single KDE plot will be generated for the concatenated ensembles. Default is False.</span>
<span class="sd">        </span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True, the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        </span>
<span class="sd">        ax: Union[None, plt.Axes, np.ndarray, List[plt.Axes]], optional</span>
<span class="sd">            The axes on which to plot. If None, new axes will be created. Default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[plt.Axes]</span>
<span class="sd">            List containing Axes objects for the scatter plot of original labels, clustering labels, feature-colored labels, and the KDE density plot, respectively.</span>

<span class="sd">        Notes</span>
<span class="sd">        ------</span>
<span class="sd">        This analysis is only valid for t-SNE dimensionality reduction.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">!=</span> <span class="s2">&quot;tsne&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for t-SNE dimensionality reduction.&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">color_by</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;rg&quot;</span><span class="p">,</span> <span class="s2">&quot;prolateness&quot;</span><span class="p">,</span> <span class="s2">&quot;asphericity&quot;</span><span class="p">,</span> <span class="s2">&quot;sasa&quot;</span><span class="p">,</span> <span class="s2">&quot;end_to_end&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="n">color_by</span><span class="si">}</span><span class="s2"> not supported.&quot;</span><span class="p">)</span>

        <span class="n">bestclust</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_kmeans</span><span class="o">.</span><span class="n">labels_</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>
            
        <span class="c1"># Create a consistent colormap for the original labels</span>
        <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">all_labels</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)))</span>
        <span class="n">label_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">)}</span>
        <span class="n">point_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">label_colors</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">all_labels</span><span class="p">]</span>

        <span class="c1"># Scatter plot with original labels</span>
        <span class="n">scatter_labeled</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">point_colors</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Scatter plot (original labels)&#39;</span><span class="p">)</span>

        <span class="c1"># Scatter plot with clustering labels</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">bestK</span><span class="p">)</span>
        <span class="n">scatter_cluster</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">bestclust</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Scatter plot (clustering labels)&#39;</span><span class="p">)</span>

        <span class="n">feature_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">color_by</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">feature_values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">feature_values</span><span class="p">)</span>

        <span class="n">feature_labeled</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">feature_labeled</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Scatter plot (</span><span class="si">{</span><span class="n">color_by</span><span class="si">}</span><span class="s1"> labels)&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kde_by_ensemble</span><span class="p">:</span>
            <span class="c1"># KDE plot for each ensemble</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">unique_labels</span><span class="p">:</span>
                <span class="n">ensemble_data</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">all_labels</span><span class="p">)</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
                <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">([</span><span class="n">ensemble_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ensemble_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]])</span>
                <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">ensemble_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span><span class="nb">max</span><span class="p">(</span><span class="n">ensemble_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span>
                                <span class="nb">min</span><span class="p">(</span><span class="n">ensemble_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]):</span><span class="nb">max</span><span class="p">(</span><span class="n">ensemble_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]):</span><span class="mi">100</span><span class="n">j</span><span class="p">]</span>
                <span class="n">zi</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">xi</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">yi</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]))</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Ensemble </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="n">label_colors</span><span class="p">[</span><span class="n">label</span><span class="p">]])</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Density Plot (Ensemble-wise)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ensemble&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Single KDE plot for concatenated ensembles</span>
            <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">([</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]])</span>
            <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span><span class="nb">max</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span>
                            <span class="nb">min</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]):</span><span class="nb">max</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">best_tsne</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]):</span><span class="mi">100</span><span class="n">j</span><span class="p">]</span>
            <span class="n">zi</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">xi</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">yi</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]))</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Density Plot&#39;</span><span class="p">)</span>

        <span class="c1"># Manage legend for the original labels</span>
        <span class="n">legend_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">label_colors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">legend_handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">label_colors</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">legend_labels</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_handles</span><span class="p">,</span> <span class="n">legend_labels</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Original Labels&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;/tsnep</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">bestP</span><span class="p">)</span><span class="si">}</span><span class="s1">_kmeans</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">bestK</span><span class="p">)</span><span class="si">}</span><span class="s1">_scatter.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ax</span>
    
<div class="viewcode-block" id="Visualization.dimensionality_reduction_scatter"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.dimensionality_reduction_scatter">[docs]</a>    <span class="k">def</span> <span class="nf">dimensionality_reduction_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="n">color_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rg&quot;</span><span class="p">,</span> 
                                         <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                                         <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                         <span class="n">kde_by_ensemble</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the results of dimensionality reduction using the method specified in the analysis.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        color_by : str, optional</span>
<span class="sd">            The feature extraction method used for coloring points in the scatter plot. </span>
<span class="sd">            Options are &quot;rg&quot;, &quot;prolateness&quot;, &quot;asphericity&quot;, &quot;sasa&quot;, and &quot;end_to_end&quot;. Default is &quot;rg&quot;.</span>

<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved in the data directory. Default is False.</span>

<span class="sd">        ax : Union[None, List[plt.Axes]], optional</span>
<span class="sd">            A list of Axes objects to plot on. Default is None, which creates new axes.</span>

<span class="sd">        kde_by_ensemble : bool, optional</span>
<span class="sd">            If True, the KDE plot will be generated for each ensemble separately. </span>
<span class="sd">            If False, a single KDE plot will be generated for the concatenated ensembles. Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[plt.Axes]</span>
<span class="sd">            List containing Axes objects for the scatter plot of original labels, clustering labels, and feature-colored labels, respectively.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            If the dimensionality reduction method specified in the analysis is not supported.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;dimenfix&quot;</span><span class="p">,</span> <span class="s2">&quot;umap&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dimenfix_umap_scatter</span><span class="p">(</span><span class="n">color_by</span><span class="o">=</span><span class="n">color_by</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">kde_by_ensemble</span><span class="o">=</span><span class="n">kde_by_ensemble</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;tsne&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tsne_scatter</span><span class="p">(</span><span class="n">color_by</span><span class="o">=</span><span class="n">color_by</span><span class="p">,</span> <span class="n">kde_by_ensemble</span><span class="o">=</span><span class="n">kde_by_ensemble</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="n">save</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Scatter plot for method &#39;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">&#39; is not implemented. Please select between &#39;tsne&#39;, &#39;dimenfix&#39;, and &#39;umap&#39;.&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_dimenfix_umap_scatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                         <span class="n">color_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;rg&quot;</span><span class="p">,</span> 
                         <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                         <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="n">kde_by_ensemble</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the complete results for dimenfix and umap methods. </span>

<span class="sd">        Parameters</span>
<span class="sd">        -----------</span>
<span class="sd">        color_by: str, optional</span>
<span class="sd">            The feature extraction method used for coloring points in the scatter plot. Options are &quot;rg&quot;, &quot;prolateness&quot;, &quot;asphericity&quot;, &quot;sasa&quot;, and &quot;end_to_end&quot;. Default is &quot;rg&quot;.</span>

<span class="sd">        save: bool, optional</span>
<span class="sd">            If True, the plot will be saved in the data directory. Default is False.</span>

<span class="sd">        ax : Union[None, List[plt.Axes]], optional</span>
<span class="sd">            A list of Axes objects to plot on. Default is None, which creates new axes.</span>
<span class="sd">        </span>
<span class="sd">        kde_by_ensemble: bool, optional</span>
<span class="sd">            If True, the KDE plot will be generated for each ensemble separately. If False, a single KDE plot will be generated for the concatenated ensembles. Default is False.</span>

<span class="sd">        Returns</span>
<span class="sd">        --------</span>
<span class="sd">        List[plt.Axes]</span>
<span class="sd">            List containing Axes objects for the scatter plot of original labels, clustering labels, and feature-colored labels, respectively.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;dimenfix&quot;</span><span class="p">,</span> <span class="s2">&quot;umap&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for dimenfix dimensionality reduction.&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">color_by</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;rg&quot;</span><span class="p">,</span> <span class="s2">&quot;prolateness&quot;</span><span class="p">,</span> <span class="s2">&quot;asphericity&quot;</span><span class="p">,</span> <span class="s2">&quot;sasa&quot;</span><span class="p">,</span> <span class="s2">&quot;end_to_end&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="n">color_by</span><span class="si">}</span><span class="s2"> not supported.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Ensure axes is a 1D array</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">ax_array</span>  <span class="c1"># If ax is provided, flatten it to 1D</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

        <span class="c1"># Create a consistent colormap for the original labels</span>
        <span class="n">unique_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">all_labels</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">)))</span>
        <span class="n">label_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">label</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">unique_labels</span><span class="p">,</span> <span class="n">colors</span><span class="p">)}</span>
        <span class="n">point_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">label_colors</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">all_labels</span><span class="p">]</span>

        <span class="c1"># Scatter plot with original labels</span>
        <span class="n">scatter_labeled</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">point_colors</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Scatter plot (original labels)&#39;</span><span class="p">)</span>

        <span class="c1"># Scatter plot with different labels</span>
        <span class="n">feature_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">color_by</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">feature_values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">feature_values</span><span class="p">)</span>
        
        <span class="n">rg_labeled</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">rg_labeled</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Scatter plot (</span><span class="si">{</span><span class="n">color_by</span><span class="si">}</span><span class="s1"> labels)&#39;</span><span class="p">)</span>

        <span class="c1"># Scatter plot with clustering labels</span>
        <span class="n">best_k</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reducer</span><span class="o">.</span><span class="n">sil_scores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">best_k</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">)</span>
        <span class="n">scatter_cluster</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Scatter plot (clustering labels)&#39;</span><span class="p">)</span>

        <span class="c1"># Manage legend for original labels</span>
        <span class="n">legend_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">label_colors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">legend_handles</span> <span class="o">=</span> <span class="p">[</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">label_colors</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">legend_labels</span><span class="p">]</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_handles</span><span class="p">,</span> <span class="n">legend_labels</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Original Labels&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kde_by_ensemble</span><span class="p">:</span>
            <span class="c1"># KDE plot for each ensemble</span>
            <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">unique_labels</span><span class="p">:</span>
                <span class="n">ensemble_data</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">all_labels</span><span class="p">)</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
                <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">([</span><span class="n">ensemble_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">ensemble_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]])</span>
                <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">ensemble_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span><span class="nb">max</span><span class="p">(</span><span class="n">ensemble_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span>
                                <span class="nb">min</span><span class="p">(</span><span class="n">ensemble_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]):</span><span class="nb">max</span><span class="p">(</span><span class="n">ensemble_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]):</span><span class="mi">100</span><span class="n">j</span><span class="p">]</span>
                <span class="n">zi</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">xi</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">yi</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]))</span>
                <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Ensemble </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="n">label_colors</span><span class="p">[</span><span class="n">label</span><span class="p">]])</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Density Plot (Ensemble-wise)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Ensemble&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Single KDE plot for concatenated ensembles</span>
            <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">([</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]])</span>
            <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span><span class="nb">max</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]):</span><span class="mi">100</span><span class="n">j</span><span class="p">,</span>
                            <span class="nb">min</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]):</span><span class="nb">max</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]):</span><span class="mi">100</span><span class="n">j</span><span class="p">]</span>
            <span class="n">zi</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">xi</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">yi</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]))</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">zi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xi</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Density Plot&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;/</span><span class="si">{</span><span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span><span class="si">}</span><span class="s1">_scatter.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">axes</span>

<div class="viewcode-block" id="Visualization.pca_cumulative_explained_variance"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.pca_cumulative_explained_variance">[docs]</a>    <span class="k">def</span> <span class="nf">pca_cumulative_explained_variance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the cumulative variance. Only applicable when the</span>
<span class="sd">        dimensionality reduction method is &quot;pca&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True, the plot will be saved in the data directory. Default is False.</span>

<span class="sd">        ax: Union[None, plt.Axes], optional</span>
<span class="sd">            An Axes object to plot on. Default is None, which creates a new axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            The Axes object for the cumulative explained variance plot.</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        
        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">!=</span> <span class="s2">&quot;pca&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for pca dimensionality reduction.&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_model</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;PCA dimension&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative explained variance %&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Cumulative Explained Variance by PCA Dimension&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">first_three_variance</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_model</span><span class="o">.</span><span class="n">explained_variance_ratio_</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;First three: </span><span class="si">{</span><span class="n">first_three_variance</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;PCA_variance&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">featurization</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">ax</span></div>

    <span class="k">def</span> <span class="nf">_set_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">reduce_dim_method</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_y</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reduce_dim_method</span><span class="si">}</span><span class="s2"> dim </span><span class="si">{</span><span class="n">dim_x</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reduce_dim_method</span><span class="si">}</span><span class="s2"> dim </span><span class="si">{</span><span class="n">dim_y</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="Visualization.pca_2d_landscapes"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.pca_2d_landscapes">[docs]</a>    <span class="k">def</span> <span class="nf">pca_2d_landscapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot 2D landscapes when the dimensionality reduction method is &quot;pca&quot; or &quot;kpca&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True the plot will be saved in the data directory. Default is False.</span>

<span class="sd">        ax: Union[None, List[plt.Axes]], optional</span>
<span class="sd">            A list of Axes objects to plot on. Default is None, which creates new axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[plt.Axes]</span>
<span class="sd">            A list of plt.Axes objects representing the subplots created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;pca&quot;</span><span class="p">,</span> <span class="s2">&quot;kpca&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for pca or kpca dimensionality reduction.&quot;</span><span class="p">)</span>

        <span class="c1"># 2D scatter plot settings</span>
        <span class="n">dim_x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dim_y</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
        <span class="n">legend_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="s2">&quot;bbox_to_anchor&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span> <span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>

        <span class="n">num_ensembles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num_ensembles</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">num_ensembles</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

        <span class="c1"># Plot all ensembles at the same time</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="p">:</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">reduce_dim_data</span><span class="p">[:,</span> <span class="n">dim_x</span><span class="p">],</span>
                            <span class="n">ensemble</span><span class="o">.</span><span class="n">reduce_dim_data</span><span class="p">[:,</span> <span class="n">dim_y</span><span class="p">],</span>
                            <span class="n">label</span><span class="o">=</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
        <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_labels</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;pca&quot;</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_y</span><span class="p">)</span>

        <span class="c1"># Concatenate all reduced dimensionality data from the dictionary</span>
        <span class="n">all_data</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span>

        <span class="c1"># Plot each ensemble individually</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
            <span class="c1"># Plot all data in gray</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">all_data</span><span class="p">[:,</span> <span class="n">dim_x</span><span class="p">],</span>
                                <span class="n">all_data</span><span class="p">[:,</span> <span class="n">dim_y</span><span class="p">],</span>
                                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                                <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
            <span class="c1"># Plot ensemble data in color</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">reduce_dim_data</span><span class="p">[:,</span> <span class="n">dim_x</span><span class="p">],</span>
                                <span class="n">ensemble</span><span class="o">.</span><span class="n">reduce_dim_data</span><span class="p">[:,</span> <span class="n">dim_y</span><span class="p">],</span>
                                <span class="n">label</span><span class="o">=</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="o">**</span><span class="n">legend_kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_labels</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;pca&quot;</span><span class="p">,</span> <span class="n">dim_x</span><span class="p">,</span> <span class="n">dim_y</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;PCA_2d_landscapes_&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">featurization</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">axes</span></div>

<div class="viewcode-block" id="Visualization.pca_1d_histograms"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.pca_1d_histograms">[docs]</a>    <span class="k">def</span> <span class="nf">pca_1d_histograms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot 1D histogram when the dimensionality reduction method is &quot;pca&quot; or &quot;kpca&quot;.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True the plot will be saved in the data directory. Default is False.</span>

<span class="sd">        ax: Union[None, List[plt.Axes]], optional</span>
<span class="sd">            A list of Axes objects to plot on. Default is None, which creates new axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[plt.Axes]</span>
<span class="sd">            A list of plt.Axes objects representing the subplots created.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;pca&quot;</span><span class="p">,</span> <span class="s2">&quot;kpca&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for pca and kpca dimensionality reduction.&quot;</span><span class="p">)</span>

        <span class="n">n_bins</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                        <span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                        <span class="n">n_bins</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">)),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

        <span class="c1"># Plot histograms for each ensemble</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">reduce_dim_data</span><span class="p">[:,</span> <span class="n">k</span><span class="p">],</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">,</span>
                        <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                        <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">[:,</span> <span class="n">k</span><span class="p">],</span>
                        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
                        <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                        <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                        <span class="n">histtype</span><span class="o">=</span><span class="s2">&quot;step&quot;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span>
                        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dim </span><span class="si">{</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;PCA_hist&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">featurization</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">axes</span></div>

<div class="viewcode-block" id="Visualization.pca_residue_correlation"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.pca_residue_correlation">[docs]</a>    <span class="k">def</span> <span class="nf">pca_residue_correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sel_dims</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the correlation between residues based on PCA weights.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sel_dims : List[int]</span>
<span class="sd">            A list of indices specifying the PCA dimensions to include in the plot.</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved as an image file. Default is False.</span>
<span class="sd">        ax : Union[None, List[plt.Axes]], optional</span>
<span class="sd">            A list of Axes objects to plot on. Default is None, which creates new axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[plt.Axes]</span>
<span class="sd">            A list of plt.Axes objects representing the subplots created.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method generates a correlation plot showing the weights of pairwise residue distances</span>
<span class="sd">        for selected PCA dimensions. The plot visualizes the correlation between residues based on</span>
<span class="sd">        the PCA weights.</span>

<span class="sd">        The analysis is only valid on PCA and kernel PCA dimensionality reduction with &#39;ca_dist&#39; feature extraction.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="o">!=</span> <span class="s2">&quot;pca&quot;</span> <span class="ow">or</span> <span class="n">analysis</span><span class="o">.</span><span class="n">featurization</span> <span class="o">!=</span> <span class="s2">&quot;ca_dist&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for pca dimensionality reduction with ca_dist feature extraction.&quot;</span><span class="p">)</span>
        
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;RdBu&quot;</span><span class="p">)</span>  <span class="c1"># RdBu, PiYG</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="o">-</span><span class="mf">0.07</span><span class="p">,</span> <span class="mf">0.07</span><span class="p">)</span>  <span class="c1"># NOTE: this range should be adapted when analyzing other systems via PCA!</span>
        <span class="n">dpi</span> <span class="o">=</span> <span class="mi">120</span>

        <span class="n">fig_r</span> <span class="o">=</span> <span class="mf">0.8</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="o">*</span><span class="n">fig_r</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">fig_r</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

        <span class="c1"># Get the number of residues from one of the trajectories</span>
        <span class="n">num_residues</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">trajectories</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">n_residues</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">sel_dim</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sel_dims</span><span class="p">):</span>
            <span class="n">feature_ids_sorted_by_weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_model</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">sel_dim</span><span class="p">,:])))</span>
            <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_residues</span><span class="p">,</span> <span class="n">num_residues</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">feature_ids_sorted_by_weight</span><span class="p">:</span>
                <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">feature_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
                <span class="c1"># Note: this should be patched for proteins with resSeq values not starting from 1!</span>
                <span class="n">matrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">r2</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_model</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">sel_dim</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">matrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">r2</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">r1</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_model</span><span class="o">.</span><span class="n">components_</span><span class="p">[</span><span class="n">sel_dim</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>  <span class="c1"># RdBu, PiYG</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Residue j&quot;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Residue i&quot;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Weight of $d_</span><span class="si">{ij}</span><span class="s2">$&quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; for PCA dim </span><span class="si">{</span><span class="n">sel_dim</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
                <span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;PCA weight&quot;</span>
            <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;PCA_correlation&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">featurization</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">axes</span></div>

<div class="viewcode-block" id="Visualization.pca_rg_correlation"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.pca_rg_correlation">[docs]</a>    <span class="k">def</span> <span class="nf">pca_rg_correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Examine and plot the correlation between PC dimension 1 and the amount of Rg.</span>
<span class="sd">        Typically high correlation can be detected here.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved in the data directory. Default is False.</span>

<span class="sd">        ax: Union[None, List[plt.Axes]], optional</span>
<span class="sd">            A list of Axes objects to plot on. Default is None, which creates new axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[plt.Axes]</span>
<span class="sd">            A list of plt.Axes objects representing the subplots created.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">analysis</span><span class="o">.</span><span class="n">reduce_dim_method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;pca&quot;</span><span class="p">,</span> <span class="s2">&quot;kpca&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Analysis is only valid for pca and kpca dimensionality reduction.&quot;</span><span class="p">)</span>

        <span class="n">pca_dim</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">)),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

        <span class="c1"># Plot the correlation for each ensemble</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="p">):</span>
            <span class="n">rg_i</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_rg</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">reduce_dim_data</span><span class="p">[:,</span> <span class="n">pca_dim</span><span class="p">],</span>
                            <span class="n">rg_i</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dim </span><span class="si">{</span><span class="n">pca_dim</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Rg&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;PCA_RG&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">axes</span></div>

<div class="viewcode-block" id="Visualization.ensemble_sasa"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.ensemble_sasa">[docs]</a>    <span class="k">def</span> <span class="nf">ensemble_sasa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                      <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> 
                      <span class="n">hist_range</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                      <span class="n">violin_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                      <span class="n">means</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                      <span class="n">medians</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                      <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                      <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the distribution of SASA for each conformation within the ensembles.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bins : int, optional</span>
<span class="sd">            The number of bins for the histogram. Default is 50.</span>
<span class="sd">        hist_range: Tuple, optional</span>
<span class="sd">            A tuple with a min and max value for the histogram. Default is None,</span>
<span class="sd">            which corresponds to using the min a max value across all data.</span>
<span class="sd">        violin_plot : bool, optional</span>
<span class="sd">            If True, a violin plot is visualized. Default is True.</span>
<span class="sd">        means : bool, optional</span>
<span class="sd">            If True, it will show the mean. Default is True.</span>
<span class="sd">        medians : bool, optional</span>
<span class="sd">            If True, it will show the median. Default is True.</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        ax : Union[None, plt.Axes], optional</span>
<span class="sd">            The matplotlib Axes object on which to plot. If None, a new Axes object will be created. Default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            The Axes object containing the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">exists_coarse_grained</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This analysis is not possible with coarse-grained models.&quot;</span><span class="p">)</span>

        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>

        <span class="c1"># Calculate features.</span>
        <span class="n">hist_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
            <span class="n">sasa_i</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">shrake_rupley</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
            <span class="n">total_sasa_i</span> <span class="o">=</span> <span class="n">sasa_i</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">hist_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_sasa_i</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>

        <span class="c1"># Plot.</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

        <span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;SASA (nm$^2$)&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;SASA distribution over the ensembles&quot;</span>

        <span class="k">if</span> <span class="n">violin_plot</span><span class="p">:</span>
            <span class="n">plot_violins</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">hist_data</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">means</span><span class="o">=</span><span class="n">means</span><span class="p">,</span>
                <span class="n">median</span><span class="o">=</span><span class="n">medians</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">axis_label</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_histogram</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">hist_data</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                <span class="nb">range</span><span class="o">=</span><span class="n">hist_range</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">axis_label</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;Global_SASA_dist&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Visualization.rg_vs_asphericity"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.rg_vs_asphericity">[docs]</a>    <span class="k">def</span> <span class="nf">rg_vs_asphericity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the Rg versus Asphericity and get the pearson correlation coefficient to evaluate </span>
<span class="sd">        the correlation between Rg and Asphericity.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True, the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        ax: plt.Axes, optional</span>
<span class="sd">            The axes on which to plot. Default is None, which creates a new figure and axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            The Axes object containing the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>  <span class="c1"># Create a new figure if ax is not provided</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>  <span class="c1"># Use the figure associated with the provided ax</span>
        
        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_rg</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">compute_asphericity</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pearson coeff for </span><span class="si">{</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Asphericity&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius of Gyration (Rg) [nm]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;Rg_vs_Asphericity_&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="k">return</span> <span class="n">ax</span></div>
  
<div class="viewcode-block" id="Visualization.rg_vs_prolateness"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.rg_vs_prolateness">[docs]</a>    <span class="k">def</span> <span class="nf">rg_vs_prolateness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the Rg versus Prolateness and get the Pearson correlation coefficient to evaluate </span>
<span class="sd">        the correlation between Rg and Prolateness. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save: bool, optional</span>
<span class="sd">            If True, the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        ax: plt.Axes, optional</span>
<span class="sd">            The axes on which to plot. Default is None, which creates a new figure and axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            The Axes object containing the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>  <span class="c1"># Create a new figure if ax is not provided</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>  <span class="c1"># Use the figure associated with the provided ax</span>

        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_rg</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">compute_prolateness</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Pearson coeff for </span><span class="si">{</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Prolateness&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius of Gyration (Rg) [nm]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;Rg_vs_Prolateness_&#39;</span> <span class="o">+</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="k">return</span> <span class="n">ax</span></div>

    <span class="k">def</span> <span class="nf">_get_protein_dssp_data_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">dssp_data_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
            <span class="n">dssp_data_dict</span><span class="p">[</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_dssp</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dssp_data_dict</span>
    
<div class="viewcode-block" id="Visualization.relative_helix_content"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.relative_helix_content">[docs]</a>    <span class="k">def</span> <span class="nf">relative_helix_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the relative helix content in each ensemble for each residue. </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved in the data directory. Default is False.</span>
<span class="sd">        ax : plt.Axes, optional</span>
<span class="sd">            The axes on which to plot. Default is None, which creates a new figure and axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            The Axes object containing the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">exists_coarse_grained</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This analysis is not possible with coarse-grained models.&quot;</span><span class="p">)</span>
        
        <span class="n">protein_dssp_data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_protein_dssp_data_dict</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

        <span class="n">bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">protein_dssp_data_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        <span class="n">max_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bottom</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">protein_name</span><span class="p">,</span> <span class="n">dssp_data</span> <span class="ow">in</span> <span class="n">protein_dssp_data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Count the occurrences of &#39;H&#39; in each column</span>
            <span class="n">h_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">dssp_data</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            
            <span class="c1"># Calculate the total number of residues for each position</span>
            <span class="n">total_residues</span> <span class="o">=</span> <span class="n">dssp_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c1"># Calculate the relative content of &#39;H&#39; for each residue</span>
            <span class="n">relative_h_content</span> <span class="o">=</span> <span class="n">h_counts</span> <span class="o">/</span> <span class="n">total_residues</span>

            <span class="c1"># Interpolate or pad the relative content to ensure all ensembles have the same length</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">relative_h_content</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">max_length</span><span class="p">:</span>
                <span class="n">relative_h_content</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">relative_h_content</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_length</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">relative_h_content</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
            
            <span class="c1"># Plot the relative content for each protein</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">relative_h_content</span><span class="p">))</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dssp_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Create a mask to filter out padded values</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">relative_h_content</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">protein_name</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="n">bottom</span> <span class="o">+=</span> <span class="n">relative_h_content</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Residue Index&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Relative Content of H (Helix)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Relative Content of H in Each Residue in the ensembles&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;relative_helix_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="k">return</span> <span class="n">ax</span></div>

    <span class="k">def</span> <span class="nf">_get_rg_data_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">rg_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
            <span class="n">rg_dict</span><span class="p">[</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_rg</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rg_dict</span>

<div class="viewcode-block" id="Visualization.radius_of_gyration"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.radius_of_gyration">[docs]</a>    <span class="k">def</span> <span class="nf">radius_of_gyration</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
            <span class="n">hist_range</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">multiple_hist_ax</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">violin_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">median</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">means</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span>
            <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the distribution of the radius of gyration (Rg) within each ensemble.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bins : int, optional</span>
<span class="sd">            The number of bins for the histogram. Default is 50.</span>
<span class="sd">        hist_range : Tuple, optional</span>
<span class="sd">            A tuple with a min and max value for the histogram. Default is None,</span>
<span class="sd">            which corresponds to using the min and max value across all data.</span>
<span class="sd">        multiple_hist_ax: bool, optional</span>
<span class="sd">            If True, it will plot each histogram in a different axis.</span>
<span class="sd">        violin_plot : bool, optional</span>
<span class="sd">            If True, a violin plot is visualized. Default is False.</span>
<span class="sd">        median : bool, optional</span>
<span class="sd">            If True, median is shown in the plot. Default is False.</span>
<span class="sd">        means : bool, optional</span>
<span class="sd">            If True, mean is shown in the plot. Default is False.</span>
<span class="sd">        dpi : int, optional</span>
<span class="sd">            The DPI (dots per inch) of the output figure. Default is 96.</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved as an image file. Default is False.</span>
<span class="sd">        ax : Union[None, plt.Axes, np.ndarray, List[plt.Axes]], optional</span>
<span class="sd">            The axes on which to plot. If None, new axes will be created. Default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Union[plt.Axes, List[plt.Axes]]</span>
<span class="sd">            Returns a single Axes object or a list of Axes objects containing the plot(s).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method plots the distribution of the radius of gyration (Rg) within each ensemble in the analysis.</span>

<span class="sd">        The Rg values are binned according to the specified number of bins (`bins`) and range (`hist_range`) and </span>
<span class="sd">        displayed as histograms. Additionally, dashed lines representing the mean and median Rg values are overlaid</span>
<span class="sd">        on each histogram.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Calculate features.</span>
        <span class="n">rg_data_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_rg_data_dict</span><span class="p">()</span>
        <span class="n">hist_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rg_data_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rg_data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">n_systems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rg_data_dict</span><span class="p">)</span>

        <span class="c1"># Plot.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">violin_plot</span> <span class="ow">and</span> <span class="n">multiple_hist_ax</span><span class="p">:</span>
            <span class="c1"># One axis for each histogram.</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
                    <span class="mi">1</span><span class="p">,</span> <span class="n">n_systems</span><span class="p">,</span>
                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">n_systems</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                    <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Only one axis for all histograms.</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

        <span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Radius of Gyration (Rg)&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Radius of Gyration&quot;</span>

        <span class="k">if</span> <span class="n">violin_plot</span><span class="p">:</span>
            <span class="n">plot_violins</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">hist_data</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">means</span><span class="o">=</span><span class="n">means</span><span class="p">,</span>
                <span class="n">median</span><span class="o">=</span><span class="n">median</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">axis_label</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">multiple_hist_ax</span><span class="p">:</span>
                <span class="n">plot_histogram</span><span class="p">(</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">hist_data</span><span class="p">,</span>
                    <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                    <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                    <span class="nb">range</span><span class="o">=</span><span class="n">hist_range</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="n">axis_label</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_bins</span> <span class="o">=</span> <span class="n">_get_hist_bins</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">=</span><span class="n">hist_data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">hist_range</span>
                <span class="p">)</span>
                <span class="n">h_args</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;histtype&quot;</span><span class="p">:</span> <span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name_i</span><span class="p">,</span> <span class="n">rg_i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rg_data_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rg_i</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">_bins</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name_i</span><span class="p">,</span> <span class="o">**</span><span class="n">h_args</span><span class="p">)</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name_i</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">axis_label</span><span class="p">)</span>
                    <span class="n">legend_handles</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">means</span><span class="p">:</span>
                        <span class="n">mean_rg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rg_i</span><span class="p">)</span>
                        <span class="n">mean_line</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean_rg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">mean_legend</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean&#39;</span><span class="p">)</span>
                        <span class="n">legend_handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_legend</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">median</span><span class="p">:</span>
                        <span class="n">median_rg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">rg_i</span><span class="p">)</span>
                        <span class="n">median_line</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">median_rg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">median_legend</span> <span class="o">=</span> <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Median&#39;</span><span class="p">)</span>
                        <span class="n">legend_handles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">median_legend</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">legend_handles</span><span class="p">:</span>
                        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_handles</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

                    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;rg_comparison_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">ax</span></div>

    <span class="k">def</span> <span class="nf">_get_distance_matrix_ens_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">distance_matrix_ens_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">atom_selector</span>
            <span class="n">trajectory</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span>
            <span class="n">xyz_ens</span> <span class="o">=</span> <span class="n">trajectory</span><span class="o">.</span><span class="n">xyz</span><span class="p">[:,</span><span class="n">trajectory</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">selector</span><span class="p">)]</span>
            <span class="n">distance_matrix_ens_dict</span><span class="p">[</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_distance_matrix</span><span class="p">(</span><span class="n">xyz_ens</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">distance_matrix_ens_dict</span>

    <span class="k">def</span> <span class="nf">_get_contact_ens_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">distance_matrix_ens_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">contact_ens_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
            <span class="n">xyz_ens</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">xyz</span><span class="p">[:,</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">atom_selector</span><span class="p">)]</span>
            <span class="n">distance_matrix_ens_dict</span><span class="p">[</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_distance_matrix</span><span class="p">(</span><span class="n">xyz_ens</span><span class="p">)</span>
            <span class="n">contact_ens_dict</span><span class="p">[</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_contact_map</span><span class="p">(</span><span class="n">distance_matrix_ens_dict</span><span class="p">[</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">contact_ens_dict</span>

<div class="viewcode-block" id="Visualization.average_distance_maps"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.average_distance_maps">[docs]</a>    <span class="k">def</span> <span class="nf">average_distance_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                            <span class="n">ticks_fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span>
                            <span class="n">cbar_fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span>
                            <span class="n">title_fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span>
                            <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span>
                            <span class="n">use_ylabel</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                            <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the average distance maps for selected ensembles.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ticks_fontsize : int, optional</span>
<span class="sd">            Font size for tick labels on the plot axes. Default is 14.</span>
<span class="sd">        cbar_fontsize : int, optional</span>
<span class="sd">            Font size for labels on the color bar. Default is 14.</span>
<span class="sd">        title_fontsize : int, optional</span>
<span class="sd">            Font size for titles of individual subplots. Default is 14.</span>
<span class="sd">        dpi : int, optional</span>
<span class="sd">            Dots per inch (resolution) of the output figure. Default is 96.</span>
<span class="sd">        use_ylabel : bool, optional</span>
<span class="sd">            If True, y-axis labels are displayed on the subplots. Default is True.</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved as an image file. Default is False.</span>
<span class="sd">        ax : Union[None, List[List[plt.Axes]], List[plt.Axes]], optional</span>
<span class="sd">            A list or 2D list of Axes objects to plot on. Default is None, which creates new axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[plt.Axes]</span>
<span class="sd">            Returns a 1D list of Axes objects representing the subplot grid.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method plots the average distance maps for selected ensembles, where each distance map</span>
<span class="sd">        represents the average pairwise distances between residues in a protein structure.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ens_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_distance_matrix_ens_dict</span><span class="p">()</span>
        <span class="n">num_proteins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ens_dict</span><span class="p">)</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Number of columns for subplots</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_proteins</span> <span class="o">+</span> <span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">cols</span>  <span class="c1"># Calculate number of rows needed</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">cols</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">rows</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Ensure axes is a 1D array</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">ax_array</span>  <span class="c1"># If ax is provided, flatten it to 1D</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">protein_name</span><span class="p">,</span> <span class="n">ens_data</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ens_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="n">avg_dmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ens_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            
            <span class="n">tril_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril_indices</span><span class="p">(</span><span class="n">avg_dmap</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">avg_dmap</span><span class="p">[</span><span class="n">tril_ids</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            
            <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">avg_dmap</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average Distance Map: </span><span class="si">{</span><span class="n">protein_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticks_fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_ylabel</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Average $d_</span><span class="si">{ij}</span><span class="s2">$ [nm]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">cbar_fontsize</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">cbar_fontsize</span><span class="p">)</span>

            <span class="n">im</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">avg_dmap</span><span class="o">.</span><span class="n">flatten</span><span class="p">())))</span>  <span class="c1"># Find the maximum distance and round it to the next integer to manage the auto range</span>
        
        <span class="c1"># Remove any empty subplots</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_proteins</span><span class="p">,</span> <span class="n">rows</span> <span class="o">*</span> <span class="n">cols</span><span class="p">):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;avg_dmap_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">axes</span>    </div>

<div class="viewcode-block" id="Visualization.end_to_end_distances"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.end_to_end_distances">[docs]</a>    <span class="k">def</span> <span class="nf">end_to_end_distances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rg_norm</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">hist_range</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">violin_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">means</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">median</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot end-to-end distance distributions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rg_norm: bool, optional</span>
<span class="sd">            Normalize end-to-end distances on the average radius of gyration.</span>
<span class="sd">        bins : int, optional</span>
<span class="sd">            The number of bins for the histogram. Default is 50.</span>
<span class="sd">        hist_range: Tuple, optional</span>
<span class="sd">            A tuple with a min and max value for the histogram. Default is None,</span>
<span class="sd">            which corresponds to using the min a max value across all data.</span>
<span class="sd">        violin_plot : bool, optional</span>
<span class="sd">            If True, a violin plot is visualized. Default is True.</span>
<span class="sd">        means : bool, optional</span>
<span class="sd">            If True, means are shown in the violin plot. Default is True.</span>
<span class="sd">        median : bool, optional</span>
<span class="sd">            If True, medians are shown in the violin plot. Default is True.</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved as an image file. Default is False.</span>
<span class="sd">        ax : plt.Axes, optional</span>
<span class="sd">            The axes on which to plot. Default is None, which creates a new figure and axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            The Axes object containing the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>

        <span class="c1"># Calculate features.</span>
        <span class="n">hist_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
            <span class="n">ca_indices</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">atom_selector</span><span class="p">)</span>
            <span class="n">hist_data_i</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_distances</span><span class="p">(</span>
                <span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,</span> <span class="p">[[</span><span class="n">ca_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ca_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">rg_norm</span><span class="p">:</span>
                <span class="n">rg_i</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_rg</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">hist_data_i</span> <span class="o">=</span> <span class="n">hist_data_i</span> <span class="o">/</span> <span class="n">rg_i</span>
            <span class="n">hist_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hist_data_i</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>

        <span class="c1"># Plot.</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rg_norm</span><span class="p">:</span>
            <span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;End-to-End distance [nm]&quot;</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;End-to-End distances distribution&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;End-to-End distance over $\langle$R$_g$$\rangle$&quot;</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;End-to-End distance over $\langle$R$_g$$\rangle$ distribution&quot;</span>

        <span class="k">if</span> <span class="n">violin_plot</span><span class="p">:</span>
            <span class="n">plot_violins</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">hist_data</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">means</span><span class="o">=</span><span class="n">means</span><span class="p">,</span>
                <span class="n">median</span><span class="o">=</span><span class="n">median</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">axis_label</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_histogram</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">hist_data</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                <span class="nb">range</span><span class="o">=</span><span class="n">hist_range</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">axis_label</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;e2e_distances_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Visualization.asphericity"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.asphericity">[docs]</a>    <span class="k">def</span> <span class="nf">asphericity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">hist_range</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">violin_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">means</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">median</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot asphericity distribution in each ensemble.</span>
<span class="sd">        Asphericity is calculated based on the gyration tensor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bins : int, optional</span>
<span class="sd">            The number of bins for the histogram. Default is 50.</span>
<span class="sd">        hist_range: Tuple, optional</span>
<span class="sd">            A tuple with a min and max value for the histogram. Default is None,</span>
<span class="sd">            which corresponds to using the min a max value across all data.</span>
<span class="sd">        violin_plot : bool, optional</span>
<span class="sd">            If True, a violin plot is visualized. Default is True.</span>
<span class="sd">        means : bool, optional</span>
<span class="sd">            If True, means are shown in the violin plot. Default is True.</span>
<span class="sd">        median : bool, optional</span>
<span class="sd">            If True, medians are shown in the violin plot. Default is True.</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved as an image file. Default is False.</span>
<span class="sd">        ax : plt.Axes, optional</span>
<span class="sd">            The axes on which to plot. Default is None, which creates a new figure and axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            The Axes object containing the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>

        <span class="c1"># Calculate features.</span>
        <span class="n">asph_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
            <span class="n">asphericity</span> <span class="o">=</span> <span class="n">compute_asphericity</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
            <span class="n">asph_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asphericity</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>

        <span class="c1"># Plot.</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

        <span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Asphericity&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Asphericity distribution&quot;</span>

        <span class="k">if</span> <span class="n">violin_plot</span><span class="p">:</span>
            <span class="n">plot_violins</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">asph_list</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">means</span><span class="o">=</span><span class="n">means</span><span class="p">,</span>
                <span class="n">median</span><span class="o">=</span><span class="n">median</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">axis_label</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_histogram</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">asph_list</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                <span class="nb">range</span><span class="o">=</span><span class="n">hist_range</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">axis_label</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;asphericity_dist_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Visualization.prolateness"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.prolateness">[docs]</a>    <span class="k">def</span> <span class="nf">prolateness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">hist_range</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">violin_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">median</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">means</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot prolateness distribution in each ensemble.</span>
<span class="sd">        Prolateness is calculated based on the gyration tensor.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bins : int, optional</span>
<span class="sd">            The number of bins for the histogram. Default is 50.</span>
<span class="sd">        hist_range : Tuple, optional</span>
<span class="sd">            A tuple with a min and max value for the histogram. Default is None,</span>
<span class="sd">            which corresponds to using the min a max value across all data.</span>
<span class="sd">        violin_plot : bool, optional</span>
<span class="sd">            If True, a violin plot is visualized. Default is True.</span>
<span class="sd">        median : bool, optional</span>
<span class="sd">            If True, median is showing in the violin plot. Default is False.</span>
<span class="sd">        means : bool, optional</span>
<span class="sd">            If True, mean is showing in the violin plot. Default is False.</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved as an image file. Default is False.</span>
<span class="sd">        ax : plt.Axes, optional</span>
<span class="sd">            The axes on which to plot. Default is None, which creates a new figure and axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            The Axes object containing the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>

        <span class="c1"># Calculate features.</span>
        <span class="n">prolat_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
            <span class="n">prolat</span> <span class="o">=</span> <span class="n">compute_prolateness</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span>
            <span class="n">prolat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prolat</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>

        <span class="c1"># Plot.</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>  <span class="c1"># Create a new figure if ax is not provided</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>  <span class="c1"># Use the figure associated with the provided ax</span>

        <span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Prolateness&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Prolateness distribution&quot;</span>

        <span class="k">if</span> <span class="n">violin_plot</span><span class="p">:</span>
            <span class="n">plot_violins</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">prolat_list</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">means</span><span class="o">=</span><span class="n">means</span><span class="p">,</span>
                <span class="n">median</span><span class="o">=</span><span class="n">median</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">axis_label</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_histogram</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">data</span><span class="o">=</span><span class="n">prolat_list</span><span class="p">,</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
                <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                <span class="nb">range</span><span class="o">=</span><span class="n">hist_range</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">axis_label</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;prolateness_dist_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Visualization.alpha_angles"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.alpha_angles">[docs]</a>    <span class="k">def</span> <span class="nf">alpha_angles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the distribution of alpha angles.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bins : int</span>
<span class="sd">            The number of bins for the histogram. Default is 50.</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved as an image file. Default is False.</span>
<span class="sd">        ax : plt.Axes, optional</span>
<span class="sd">            The axes on which to plot. Default is None, which creates a new figure and axes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            The Axes object containing the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
            <span class="n">data_i</span> <span class="o">=</span> <span class="n">featurize_a_angle</span><span class="p">(</span>
                <span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,</span>
                <span class="n">get_names</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">atom_selector</span><span class="o">=</span><span class="n">ensemble</span><span class="o">.</span><span class="n">atom_selector</span>
            <span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_i</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>

        <span class="n">plot_histogram</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
            <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Distribution of alpha angles&quot;</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;angle [rad]&quot;</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;alpha_dist_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Visualization.contact_prob_maps"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.contact_prob_maps">[docs]</a>    <span class="k">def</span> <span class="nf">contact_prob_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                        <span class="n">min_sep</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">max_sep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
                        <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span> 
                        <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                        <span class="n">cmap_color</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span>
                        <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
        <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the contact probability map based on the threshold.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        norm : bool, optional</span>
<span class="sd">            If True, use log scale range. Default is True.</span>
<span class="sd">        min_sep : int, optional</span>
<span class="sd">            Minimum separation distance between atoms to consider. Default is 2.</span>
<span class="sd">        max_sep : int, optional</span>
<span class="sd">            Maximum separation distance between atoms to consider. Default is None.</span>
<span class="sd">        threshold : float, optional</span>
<span class="sd">            Determining the threshold for calculating the contact frequencies. Default is 0.8 [nm].</span>
<span class="sd">        dpi : int, optional</span>
<span class="sd">            For changing the quality and dimension of the output figure. Default is 96.</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved as an image file. Default is False.</span>
<span class="sd">        cmap_color : str, optional</span>
<span class="sd">            Select a color for the contact map. Default is &quot;Blues&quot;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Union[List[plt.Axes], np.ndarray]</span>
<span class="sd">            Returns a list or array of Axes objects representing the subplot grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">num_proteins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ensembles</span><span class="p">)</span>
        <span class="n">num_cols</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">num_rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_proteins</span> <span class="o">+</span> <span class="n">num_cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">num_cols</span>

        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap_color</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">num_cols</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">num_rows</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">ax_array</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ensembles</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">coarse_grained</span><span class="p">:</span>
                <span class="n">matrix_p_map</span> <span class="o">=</span> <span class="n">contact_probability_map</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">scheme</span><span class="o">=</span><span class="s1">&#39;closest&#39;</span><span class="p">,</span> <span class="n">contact</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pair_ids</span><span class="p">(</span><span class="n">min_sep</span><span class="o">=</span><span class="n">min_sep</span><span class="p">,</span> <span class="n">max_sep</span><span class="o">=</span><span class="n">max_sep</span><span class="p">),</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">matrix_p_map</span> <span class="o">=</span> <span class="n">contact_probability_map</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">norm</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">matrix_p_map</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">matrix_p_map</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Contact Probability Map: </span><span class="si">{</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

            <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

        <span class="c1"># Remove any empty subplots</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_proteins</span><span class="p">,</span> <span class="n">num_rows</span> <span class="o">*</span> <span class="n">num_cols</span><span class="p">):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;contact_prob_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">return</span> <span class="n">axes</span></div>

    <span class="k">def</span> <span class="nf">_pair_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_sep</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">max_sep</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">):</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>
        <span class="n">pair_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ens</span> <span class="ow">in</span> <span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="p">:</span>
            <span class="n">ca_ids</span> <span class="o">=</span> <span class="n">ens</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ens</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
            <span class="n">max_sep</span> <span class="o">=</span> <span class="n">get_max_sep</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">),</span> <span class="n">max_sep</span><span class="o">=</span><span class="n">max_sep</span><span class="p">)</span>
    <span class="c1"># Get all pair of ids.</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">id_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ca_ids</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">id_j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ca_ids</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">min_sep</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">j</span> <span class="o">-</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">max_sep</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">pair_ids</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">id_i</span><span class="p">,</span> <span class="n">id_j</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">pair_ids</span>
    
<div class="viewcode-block" id="Visualization.ramachandran_plots"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.ramachandran_plots">[docs]</a>    <span class="k">def</span> <span class="nf">ramachandran_plots</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">two_d_hist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">linespaces</span><span class="p">:</span> <span class="n">Tuple</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span>
            <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">],</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ramachandran plot. If two_d_hist=True it returns a 2D histogram </span>
<span class="sd">        for each ensemble. If two_d_hist=False it returns a simple scatter plot </span>
<span class="sd">        for all ensembles in one plot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        two_d_hist : bool, optional</span>
<span class="sd">            If True, it returns a 2D histogram for each ensemble. Default is True.</span>
<span class="sd">        linespaces : tuple, optional</span>
<span class="sd">            You can customize the bins for 2D histogram. Default is (-180, 180, 80).</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved as an image file. Default is False.</span>
<span class="sd">        ax : Union[None, plt.Axes, np.ndarray, List[plt.Axes]], optional</span>
<span class="sd">            The axes on which to plot. If None, new axes will be created. Default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Union[List[plt.Axes], plt.Axes]</span>
<span class="sd">            If two_d_hist=True, returns a list of Axes objects representing the subplot grid for each ensemble. </span>
<span class="sd">            If two_d_hist=False, returns a single Axes object representing the scatter plot for all ensembles.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">exists_coarse_grained</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This analysis is not possible with coarse-grained models.&quot;</span><span class="p">)</span>
        
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="k">if</span> <span class="n">two_d_hist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ensembles</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">ensembles</span><span class="p">),</span> <span class="mi">5</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>
            <span class="c1"># Ensure ax is always a list</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
            <span class="n">rama_linspace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">linespaces</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linespaces</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">linespaces</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">ens</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ensembles</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
                <span class="n">phi_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_phi</span><span class="p">(</span><span class="n">ens</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">psi_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_psi</span><span class="p">(</span><span class="n">ens</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">hist</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span>
                    <span class="n">phi_flat</span><span class="p">,</span>
                    <span class="n">psi_flat</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
                    <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="n">rama_linspace</span><span class="p">,</span> <span class="n">rama_linspace</span><span class="p">),</span> 
                    <span class="n">norm</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(),</span>
                    <span class="n">density</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

                <span class="n">axis</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ramachandran Plot for cluster </span><span class="si">{</span><span class="n">ens</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">axis</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Phi (ϕ) Angle (degrees)&#39;</span><span class="p">)</span>
                <span class="n">axis</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Psi (ψ) Angle (degrees)&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>
            <span class="k">for</span> <span class="n">ens</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_phi</span><span class="p">(</span><span class="n">ens</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">compute_psi</span><span class="p">(</span><span class="n">ens</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ens</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Phi (ϕ) Angle (degrees)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Psi (ψ) Angle (degrees)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;ramachandran_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  

        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Visualization.ss_flexibility_parameter"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.ss_flexibility_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">ss_flexibility_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                                <span class="n">pointer</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                                <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> 
                                <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a plot of the site-specific flexibility parameter.</span>
<span class="sd">        </span>
<span class="sd">        This plot shows the site-specific measure of disorder, which is sensitive to local flexibility based on </span>
<span class="sd">        the circular variance of the Ramachandran angles φ and ψ for each residue in the ensemble.</span>
<span class="sd">        The score ranges from 0 for identical dihedral angles for all conformers at the residue i to 1 for a </span>
<span class="sd">        uniform distribution of dihedral angles at the residue i.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pointer: List[int], optional</span>
<span class="sd">            A list of desired residues. Vertical dashed lines will be added to point to these residues. Default is None.</span>
<span class="sd">        figsize: Tuple[int, int], optional</span>
<span class="sd">            The size of the figure. Default is (15, 5).</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, save the plot as an image file. Default is False.</span>
<span class="sd">        ax : Union[None, plt.Axes], optional</span>
<span class="sd">            The matplotlib Axes object on which to plot. If None, a new Axes object will be created. Default is None.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            The matplotlib Axes object containing the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">exists_coarse_grained</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This analysis is not possible with coarse-grained models.&quot;</span><span class="p">)</span>
        
        <span class="n">features_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">featurization</span><span class="o">=</span><span class="s1">&#39;phi_psi&#39;</span><span class="p">)</span>
        
        <span class="n">f</span> <span class="o">=</span> <span class="n">ss_measure_disorder</span><span class="p">(</span><span class="n">features_dict</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Residue Index&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Site-specific flexibility parameter&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">pointer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">pointer</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;ss_flexibility_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  

        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Visualization.ss_order_parameter"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.ss_order_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">ss_order_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                        <span class="n">pointer</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                        <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> 
                        <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                        <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a plot of the site-specific order parameter.</span>
<span class="sd">        </span>
<span class="sd">        This plot shows the site-specific order parameter, which abstracts from local chain flexibility.</span>
<span class="sd">        The parameter is still site-specific, as orientation correlations in IDRs and IDPs decrease with increasing sequence distance.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pointer: List[int], optional</span>
<span class="sd">            A list of desired residues. Vertical dashed lines will be added to point to these residues. Default is None.</span>
<span class="sd">        figsize: Tuple[int, int], optional</span>
<span class="sd">            The size of the figure. Default is (15, 5).</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved as an image file. Default is False.</span>
<span class="sd">        ax : Union[None, plt.Axes], optional</span>
<span class="sd">            The matplotlib Axes object on which to plot. If None, a new Axes object will be created. Default is None.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            The matplotlib Axes object containing the plot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ensembles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span>
        <span class="n">dict_ca_xyz</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ensemble</span> <span class="ow">in</span> <span class="n">ensembles</span><span class="p">:</span>
            <span class="n">ca_index</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">atom_selector</span><span class="p">)</span>
            <span class="n">dict_ca_xyz</span><span class="p">[</span><span class="n">ensemble</span><span class="o">.</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">ensemble</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">xyz</span><span class="p">[:,</span> <span class="n">ca_index</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">dict_order_parameter</span> <span class="o">=</span> <span class="n">site_specific_order_parameter</span><span class="p">(</span><span class="n">dict_ca_xyz</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">dict_order_parameter</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Residue Index&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Site-specific order parameter&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">pointer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">pointer</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;ss_order_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  
        
        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Visualization.per_residue_mean_sasa"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.per_residue_mean_sasa">[docs]</a>    <span class="k">def</span> <span class="nf">per_residue_mean_sasa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                            <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> 
                            <span class="n">pointer</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                            <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> 
                            <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the average solvent-accessible surface area (SASA) for each residue among all conformations in an ensemble.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        figsize: Tuple[int, int], optional</span>
<span class="sd">            Tuple specifying the size of the figure. Default is (15, 5).</span>
<span class="sd">        pointer: List[int], optional</span>
<span class="sd">            List of desired residues to highlight with vertical dashed lines. Default is None.</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, the plot will be saved as an image file. Default is False.</span>
<span class="sd">        ax : Union[None, plt.Axes], optional</span>
<span class="sd">            The matplotlib Axes object on which to plot. If None, a new Axes object will be created. Default is None.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        plt.Axes</span>
<span class="sd">            Axes object containing the plot.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span>

        <span class="c1"># Get the color cycle from matplotlib</span>
        <span class="n">prop_cycle</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.prop_cycle&#39;</span><span class="p">]</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="n">prop_cycle</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ens</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)]</span>
            <span class="n">res_based_sasa</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">shrake_rupley</span><span class="p">(</span><span class="n">ens</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;residue&#39;</span><span class="p">)</span>
            <span class="n">sasa_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">res_based_sasa</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">sasa_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">res_based_sasa</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>        

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sasa_mean</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">sasa_mean</span><span class="p">,</span> <span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ens</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
            <span class="c1"># ax.fill_between(np.arange(1, len(sasa_mean) + 1), sasa_mean - sasa_std, sasa_mean + sasa_std, alpha=0.3, color=colors[i % len(colors)])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sasa_mean</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">sasa_mean</span> <span class="o">+</span> <span class="n">sasa_std</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sasa_mean</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">sasa_mean</span> <span class="o">-</span> <span class="n">sasa_std</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sasa_mean</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Residue Index&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Mean SASA&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mean SASA for Each Residue in Ensembles&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="c1"># ax.grid(True)</span>
        
        <span class="k">if</span> <span class="n">pointer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">pointer</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;local_sasa_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ens_codes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  

        <span class="k">return</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="Visualization.ca_com_distances"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.ca_com_distances">[docs]</a>    <span class="k">def</span> <span class="nf">ca_com_distances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                         <span class="n">min_sep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> 
                         <span class="n">max_sep</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
                         <span class="n">get_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                         <span class="n">inverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                         <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the distance maps comparing the center of mass (COM) and alpha-carbon (CA) distances within each ensemble.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        min_sep : int, optional</span>
<span class="sd">            Minimum separation distance between atoms to consider. Default is 2.</span>
<span class="sd">        max_sep : int or None, optional</span>
<span class="sd">            Maximum separation distance between atoms to consider. Default is None, which means no maximum separation.</span>
<span class="sd">        get_names : bool, optional</span>
<span class="sd">            Whether to get the residue names for the features. Default is True.</span>
<span class="sd">        inverse : bool, optional</span>
<span class="sd">            Whether to compute the inverse distances. Default is False.</span>
<span class="sd">        figsize : tuple, optional</span>
<span class="sd">            Figure size in inches (width, height). Default is (6, 2.5).</span>
<span class="sd">        save : bool, optional</span>
<span class="sd">            If True, save the plot as an image file. Default is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        List[plt.Axes]</span>
<span class="sd">            A list containing Axes objects corresponding to the plots for CA and COM distances.</span>

<span class="sd">        Notes:</span>
<span class="sd">        ------</span>
<span class="sd">        This method plots the average distance maps for the center of mass (COM) and alpha-carbon (CA) distances</span>
<span class="sd">        within each ensemble. It computes the distance matrices for COM and CA atoms and then calculates their</span>
<span class="sd">        mean values to generate the distance maps. The plots include color bars indicating the distance range.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">exists_coarse_grained</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This analysis is not possible with coarse-grained models.&quot;</span><span class="p">)</span>
        
        <span class="n">num_proteins</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_proteins</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">num_proteins</span><span class="p">))</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">ax_array</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">figure</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ens</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">ensembles</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="n">traj</span> <span class="o">=</span> <span class="n">ens</span><span class="o">.</span><span class="n">trajectory</span>
            <span class="n">feat</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="n">featurize_com_dist</span><span class="p">(</span><span class="n">traj</span><span class="o">=</span><span class="n">traj</span><span class="p">,</span> <span class="n">min_sep</span><span class="o">=</span><span class="n">min_sep</span><span class="p">,</span><span class="n">max_sep</span><span class="o">=</span><span class="n">max_sep</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="n">inverse</span> <span class="p">,</span><span class="n">get_names</span><span class="o">=</span><span class="n">get_names</span><span class="p">)</span>  <span class="c1"># Compute (N, *) feature arrays.</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;# Ensemble: </span><span class="si">{</span><span class="n">ens</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;features:&quot;</span><span class="p">,</span> <span class="n">feat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="n">com_dmap</span> <span class="o">=</span> <span class="n">calc_ca_dmap</span><span class="p">(</span><span class="n">traj</span><span class="o">=</span><span class="n">traj</span><span class="p">)</span>
            <span class="n">com_dmap_mean</span> <span class="o">=</span> <span class="n">com_dmap</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">ca_dmap</span> <span class="o">=</span> <span class="n">calc_ca_dmap</span><span class="p">(</span><span class="n">traj</span><span class="o">=</span><span class="n">traj</span><span class="p">)</span>
            <span class="n">ca_dmap_mean</span> <span class="o">=</span> <span class="n">ca_dmap</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;distance matrix:&quot;</span><span class="p">,</span> <span class="n">com_dmap_mean</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            
            <span class="n">im0</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ca_dmap_mean</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ens</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2"> CA&quot;</span><span class="p">)</span>
            <span class="n">im1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">com_dmap_mean</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ens</span><span class="o">.</span><span class="n">code</span><span class="si">}</span><span class="s2"> COM&quot;</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;distance [nm]&quot;</span><span class="p">)</span>
            <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;distance [nm]&quot;</span><span class="p">)</span>

            <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dir</span><span class="p">,</span> <span class="s1">&#39;dist_ca_com_&#39;</span> <span class="o">+</span> <span class="n">ens</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>  

        <span class="k">return</span> <span class="n">axes</span></div>
    
    
<div class="viewcode-block" id="Visualization.comparison_matrix"><a class="viewcode-back" href="../../visualization.html#dpet.visualization.Visualization.comparison_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">comparison_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">score</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
            <span class="n">featurization_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
            <span class="n">bootstrap_iters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
            <span class="n">bootstrap_frac</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="n">bootstrap_replace</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">bins</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
            <span class="n">random_seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">ax</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">figsize</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6.00</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span>
            <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
            <span class="n">std</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">cmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;viridis_r&quot;</span><span class="p">,</span>
            <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">cbar_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">textcolors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates and visualizes the pairwise comparison matrix for the ensembles.</span>
<span class="sd">        This function computes the comparison matrix using the specified score</span>
<span class="sd">        type and feature. It then visualizes the matrix using a heatmap.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        score, feature, featurization_params, bootstrap_iters, bootstrap_frac,</span>
<span class="sd">        bootstrap_replace, bins, random_seed, verbose:</span>
<span class="sd">            See the documentation of `EnsembleAnalysis.comparison_scores` for</span>
<span class="sd">            more information about these arguments.</span>
<span class="sd">        ax: Union[None, plt.Axes], optional</span>
<span class="sd">            Axes object where to plot the comparison heatmap. If `None` (the</span>
<span class="sd">            default value) is provided, a new Figure will be created.</span>
<span class="sd">        figsize: Tuple[int], optional</span>
<span class="sd">            The size of the figure for the heatmap. Default is (6.00, 5.0). Only</span>
<span class="sd">            takes effect if `ax` is not `None`.</span>
<span class="sd">        dpi: int, optional</span>
<span class="sd">            DPIs of the figure for the heatmap. Default is 100. Only takes</span>
<span class="sd">            effect if `ax` is not `None`.</span>
<span class="sd">        std, cmap, title, cbar_label, textcolors:</span>
<span class="sd">            See the documentation of `dpet.visualization.plot_comparison_matrix`</span>
<span class="sd">            for more information about these arguments.</span>

<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">        results: dict</span>
<span class="sd">            A dictionary containing the following keys:</span>
<span class="sd">                `ax`: the Axes object with the comparison matrix heatmap.</span>
<span class="sd">                `scores`: comparison matrix. See `EnsembleAnalysis.comparison_scores`</span>
<span class="sd">                    for more information.</span>
<span class="sd">                `codes`: codes of the ensembles that were compared.</span>
<span class="sd">                `fig`: Figure object, only returned when a new figure is created</span>
<span class="sd">                    inside this function.</span>

<span class="sd">        Notes:</span>
<span class="sd">        ------</span>
<span class="sd">        The comparison matrix is annotated with the scores, and the axes are</span>
<span class="sd">        labeled with the ensemble labels.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">### Score divergences.</span>
        <span class="n">scores</span><span class="p">,</span> <span class="n">codes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">comparison_scores</span><span class="p">(</span>
            <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span>
            <span class="n">feature</span><span class="o">=</span><span class="n">feature</span><span class="p">,</span>
            <span class="n">featurization_params</span><span class="o">=</span><span class="n">featurization_params</span><span class="p">,</span>
            <span class="n">bootstrap_iters</span><span class="o">=</span><span class="n">bootstrap_iters</span><span class="p">,</span>
            <span class="n">bootstrap_frac</span><span class="o">=</span><span class="n">bootstrap_frac</span><span class="p">,</span>
            <span class="n">bootstrap_replace</span><span class="o">=</span><span class="n">bootstrap_replace</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
            <span class="n">random_seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>

        <span class="c1">### Setup the plot.</span>
        <span class="c1"># Axes.</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Title.</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">score</span> <span class="o">==</span> <span class="s2">&quot;emd&quot;</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">score</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> based on </span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">score</span> <span class="o">==</span> <span class="s2">&quot;jsd&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">feature</span> <span class="o">==</span> <span class="s2">&quot;ca_dist&quot;</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;aJSD_d&quot;</span>
                <span class="k">elif</span> <span class="n">feature</span> <span class="o">==</span> <span class="s2">&quot;alpha_angle&quot;</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;aJSD_t&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">score</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> based on </span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
        <span class="c1"># Colorbar label.</span>
        <span class="k">if</span> <span class="n">cbar_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cbar_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">score</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> score&quot;</span>

        <span class="c1">### Actually plots.</span>
        <span class="n">plot_comparison_matrix</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">scores</span><span class="o">=</span><span class="n">scores</span><span class="p">,</span>
            <span class="n">codes</span><span class="o">=</span><span class="n">codes</span><span class="p">,</span>
            <span class="n">std</span><span class="o">=</span><span class="n">std</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
            <span class="n">cbar_label</span><span class="o">=</span><span class="n">cbar_label</span><span class="p">,</span>
            <span class="n">textcolors</span><span class="o">=</span><span class="n">textcolors</span>
        <span class="p">)</span>

        <span class="c1">### Return results.</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ax&quot;</span><span class="p">:</span> <span class="n">ax</span><span class="p">,</span> <span class="s2">&quot;scores&quot;</span><span class="p">:</span> <span class="n">scores</span><span class="p">,</span> <span class="s2">&quot;codes&quot;</span><span class="p">:</span> <span class="n">codes</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="s2">&quot;fig&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
        <span class="k">return</span> <span class="n">results</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Hamidreza Ghafouri, Giacomo Janson, Nikola Ivanović.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>